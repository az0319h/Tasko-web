# Vercel 배포 전 최종 점검 보고서 (Pre-deploy Audit)

**점검 일시**: 2025-01-XX  
**점검 범위**: 빌드 단계, 런타임 단계, 환경 변수, API 호출, CSR 전환 영향, 성능, 보안  
**점검 원칙**: 보수적 분석, 가능성만 있어도 리스크로 분류

---

## 🔴 CRITICAL - 배포 실패 가능성

### 1. 환경 변수 누락으로 인한 빌드/런타임 실패

**문제 요약**:  
`src/lib/supabase.ts`에서 `import.meta.env.VITE_SUPABASE_URL`과 `VITE_SUPABASE_ANON_KEY`를 사용하지만, Vercel 환경 변수 설정이 누락되면 `undefined`가 전달되어 Supabase 클라이언트 생성 실패 가능성

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- Vercel은 빌드 시점에 환경 변수를 주입하지만, 설정하지 않으면 `undefined` 반환
- `createClient(undefined, undefined)` 호출 시 런타임 에러 발생
- 모든 API 호출이 실패하여 앱이 동작하지 않음

**발생 조건**:  
- Vercel 프로젝트 설정에서 `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` 미설정
- 환경 변수 이름 오타 (예: `VITE_SUPABASE_URL` vs `SUPABASE_URL`)

**지금 당장 조치 필요**: ✅ **YES**  
**조치 레벨**: **설정 레벨** (Vercel 환경 변수 설정)

---

### 2. 환경 변수 타입 검증 부재

**문제 요약**:  
`src/lib/supabase.ts`에서 환경 변수를 직접 사용하지만, `undefined` 체크나 타입 가드가 없음. 빌드는 성공하지만 런타임에서 실패 가능

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- TypeScript 빌드는 통과하지만 (`import.meta.env`는 `string | undefined` 타입)
- 런타임에서 `undefined`가 전달되면 Supabase 클라이언트가 비정상 동작
- 에러 메시지가 명확하지 않아 디버깅 어려움

**발생 조건**:  
- 환경 변수 값이 빈 문자열이거나 공백
- 환경 변수가 설정되었지만 값이 잘못됨

**지금 당장 조치 필요**: ✅ **YES**  
**조치 레벨**: **프론트 레벨** (환경 변수 검증 로직 추가)

---

### 3. VITE_FRONTEND_URL 환경 변수 누락 가능성

**문제 요약**:  
`src/api/password.ts`, `src/api/email.ts`, `src/api/admin.ts`에서 `import.meta.env.VITE_FRONTEND_URL` 사용. 미설정 시 fallback이 있지만 일관성 없음

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- `src/api/password.ts`는 fallback 없음 → `undefined` 전달 가능
- `src/api/email.ts`는 `"http://localhost:5173"` fallback → 프로덕션에서 잘못된 URL 사용
- `src/api/admin.ts`는 fallback 없음 → `undefined` 전달 가능
- 이메일 리다이렉트 URL이 잘못되어 사용자 경험 저하

**발생 조건**:  
- Vercel에서 `VITE_FRONTEND_URL` 미설정
- 프로덕션 도메인과 다른 값 설정

**지금 당장 조치 필요**: ✅ **YES**  
**조치 레벨**: **프론트 레벨** (환경 변수 검증 및 일관된 fallback 처리)

---

## 🟠 HIGH - 런타임 오류 가능성

### 4. 전체 데이터 fetch 실패 시 UI 깨짐

**문제 요약**:  
`src/pages/index-page.tsx`에서 `useProjects()`가 실패하면 `allProjects = []`로 fallback하지만, 에러 상태를 처리하지 않음. 네트워크 오류나 RLS 정책 오류 시 사용자에게 피드백 없음

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 프로덕션 환경에서 네트워크 지연/타임아웃 발생 가능
- Supabase RLS 정책 오류 시 빈 화면만 표시
- 사용자가 문제를 인지하지 못하고 계속 대기

**발생 조건**:  
- 네트워크 연결 불안정
- Supabase 서비스 장애
- RLS 정책 오류
- 인증 토큰 만료

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (에러 상태 처리 및 사용자 피드백)

---

### 5. React Query Devtools 프로덕션 포함

**문제 요약**:  
`src/main.tsx`에서 `<ReactQueryDevtools />`가 프로덕션 빌드에도 포함됨. 개발 도구가 프로덕션에 노출됨

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 불필요한 번들 크기 증가
- 보안상 내부 상태 노출 가능성 (낮지만)
- 성능 오버헤드 (미미하지만)

**발생 조건**:  
- 항상 발생 (현재 코드 상태)

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (환경 변수로 조건부 렌더링)

---

### 6. Supabase 클라이언트 싱글톤 초기화 시점 문제

**문제 요약**:  
`src/lib/supabase.ts`에서 모듈 레벨에서 즉시 `createClient()` 호출. 환경 변수가 `undefined`일 때 클라이언트가 잘못된 상태로 생성됨

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 모듈 로드 시점에 환경 변수가 아직 주입되지 않았을 수 있음 (드물지만)
- 잘못된 클라이언트가 앱 전체에서 재사용됨
- 에러가 나중에 다른 곳에서 발생하여 디버깅 어려움

**발생 조건**:  
- 환경 변수 로딩 타이밍 이슈 (드묾)
- 빌드 시점과 런타임 시점의 환경 변수 차이

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (환경 변수 검증 후 클라이언트 생성)

---

### 7. 클라이언트 사이드 필터링 성능 문제 (대용량 데이터)

**문제 요약**:  
`src/pages/index-page.tsx`에서 `useMemo`로 필터링하지만, 프로젝트가 수천 개 이상일 경우 메모리/CPU 부하 가능

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 프로젝트가 많아지면 전체 데이터를 한 번에 fetch하여 초기 로딩 시간 증가
- 클라이언트에서 모든 데이터를 메모리에 보관하여 메모리 사용량 증가
- 필터링/정렬 연산이 메인 스레드를 블로킹하여 UI 프리징 가능

**발생 조건**:  
- 프로젝트 수가 1000개 이상
- 저사양 디바이스 (모바일)
- 네트워크가 느린 환경

**지금 당장 조치 필요**: ⚠️ **모니터링 필요**  
**조치 레벨**: **프론트 레벨** (가상화 또는 페이지네이션 고려, 현재는 모니터링)

---

### 8. useMemo 의존성 배열로 인한 무한 루프 가능성

**문제 요약**:  
`src/pages/index-page.tsx`의 `filteredProjects` useMemo가 `allProjects` 배열 참조를 의존성으로 사용. 배열이 매번 새로 생성되면 불필요한 재계산 발생

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- React Query가 데이터를 새로 fetch할 때마다 새 배열 참조 생성
- useMemo가 매번 재계산되어 성능 저하
- 특히 대용량 데이터에서 문제 심화

**발생 조건**:  
- React Query refetch 발생 시
- 데이터 업데이트 시

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (의존성 배열 최적화 또는 useMemo 제거 검토)

---

### 9. 페이지네이션 상태와 필터링 결과 불일치

**문제 요약**:  
필터링 결과가 변경되어 총 페이지 수가 줄어들 때, `currentPage`가 `totalPages`보다 큰 경우가 발생할 수 있음. `useEffect`로 처리하지만 타이밍 이슈 가능

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- React 렌더링 사이클에서 상태 업데이트 순서에 따라 빈 페이지 표시 가능
- 사용자가 존재하지 않는 페이지를 보고 있을 수 있음

**발생 조건**:  
- 필터링으로 결과가 줄어들 때
- 페이지 변경과 필터 변경이 동시에 발생할 때

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (상태 동기화 로직 강화)

---

## 🟡 MEDIUM - 예상과 다르게 동작할 가능성

### 10. React Query staleTime 설정 불일치

**문제 요약**:  
`src/main.tsx`의 QueryClient 기본 설정은 `staleTime: 0`이지만, `useProjects()`는 `staleTime: 30 * 1000`으로 오버라이드. 다른 쿼리들은 기본값 사용으로 일관성 없음

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 데이터 갱신 타이밍이 예상과 다를 수 있음
- 사용자가 최신 데이터를 보지 못할 수 있음
- 다른 페이지와 동작이 달라 혼란 가능

**발생 조건**:  
- 항상 발생 (설정 불일치)

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (일관된 staleTime 정책 수립)

---

### 11. refetchOnMount로 인한 불필요한 재요청

**문제 요약**:  
`src/main.tsx`에서 `refetchOnMount: true` 설정. 페이지 이동 시마다 데이터를 재요청하여 네트워크 트래픽 증가

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- Supabase API 호출 제한에 도달할 가능성
- 사용자 데이터 사용량 증가
- 서버 부하 증가

**발생 조건**:  
- 항상 발생 (현재 설정)

**지금 당장 조치 필요**: ⚠️ **모니터링 필요**  
**조치 레벨**: **프론트 레벨** (staleTime과 함께 조정)

---

### 12. 로딩 상태 처리로 인한 깜빡임

**문제 요약**:  
`src/pages/index-page.tsx`에서 `isLoading`일 때 전체 화면을 스피너로 교체. 데이터가 캐시되어 있어도 깜빡임 발생 가능

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- `refetchOnMount: true`로 인해 매번 재요청
- 캐시가 있어도 로딩 상태가 잠깐 표시됨
- 사용자 경험 저하

**발생 조건**:  
- 페이지 방문 시마다 발생

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (로딩 상태 처리 개선)

---

### 13. 검색어 debounce와 페이지 리셋 타이밍 이슈

**문제 요약**:  
`debouncedSearch` 변경 시 `useEffect`로 페이지를 리셋하지만, debounce 지연으로 인해 사용자가 입력 중인데 페이지가 변경될 수 있음

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 사용자가 페이지 2에 있는 상태에서 검색어 입력
- debounce로 인해 300ms 후 페이지가 1로 리셋
- 사용자가 혼란스러울 수 있음

**발생 조건**:  
- 검색어 입력 중 페이지 변경 시

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (UX 개선)

---

### 14. 빈 상태 메시지가 필터링 결과와 혼동 가능

**문제 요약**:  
`src/pages/index-page.tsx`에서 빈 상태 메시지가 "검색 결과가 없습니다"와 "프로젝트가 없습니다"로 구분되지만, 실제로는 필터링 결과가 0개일 때도 동일 메시지 표시

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 사용자가 필터를 적용했는지 확인하기 어려움
- UX 혼란 가능

**발생 조건**:  
- 필터 적용 후 결과가 0개일 때

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (메시지 개선)

---

## 🔵 LOW - 보안/권한/데이터 노출 위협

### 15. 환경 변수가 클라이언트 번들에 포함됨

**문제 요약**:  
Vite는 `VITE_` 접두사 환경 변수를 클라이언트 번들에 포함시킴. `VITE_SUPABASE_ANON_KEY`는 공개되어도 안전하지만, `VITE_FRONTEND_URL` 등이 노출됨

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 번들 분석으로 환경 변수 값 확인 가능
- 민감하지 않지만 정보 노출

**발생 조건**:  
- 항상 발생 (Vite 동작 방식)

**지금 당장 조치 필요**: ❌ **NO** (의도된 동작, anon key는 공개용)

---

### 16. React Query Devtools로 인한 내부 상태 노출

**문제 요약**:  
프로덕션에 React Query Devtools가 포함되면, 브라우저 콘솔에서 쿼리 상태 확인 가능

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 내부 데이터 구조 노출
- 쿼리 키 패턴 노출로 API 구조 추론 가능

**발생 조건**:  
- 항상 발생 (현재 코드)

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (프로덕션에서 제거)

---

### 17. 에러 메시지에 내부 정보 노출 가능성

**문제 요약**:  
`src/api/project.ts` 등에서 `error.message`를 그대로 사용. Supabase 에러 메시지에 내부 정보가 포함될 수 있음

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 데이터베이스 스키마 정보 노출
- RLS 정책 정보 노출
- 디버깅 정보 노출

**발생 조건**:  
- API 에러 발생 시

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (에러 메시지 sanitization)

---

### 18. console.log가 프로덕션에 포함됨

**문제 요약**:  
`src/api/task.ts`에 `console.log` 디버깅 코드가 포함됨. 프로덕션에서도 실행됨

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 브라우저 콘솔에 내부 정보 노출
- 성능 오버헤드 (미미하지만)

**발생 조건**:  
- Task 업데이트 시

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (프로덕션에서 제거 또는 조건부)

---

## 🟢 INFO - 성능/UX 저하 가능성

### 19. 전체 데이터 fetch로 인한 초기 로딩 시간 증가

**문제 요약**:  
클라이언트 사이드 페이지네이션으로 전환하면서 전체 데이터를 한 번에 fetch. 프로젝트가 많을수록 초기 로딩 시간 증가

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 네트워크 지연이 큰 환경에서 사용자 대기 시간 증가
- 모바일 환경에서 데이터 사용량 증가
- 첫 화면 렌더링 지연

**발생 조건**:  
- 프로젝트 수가 많을 때
- 네트워크가 느린 환경

**지금 당장 조치 필요**: ⚠️ **모니터링 필요**  
**조치 레벨**: **프론트 레벨** (로딩 상태 표시 개선, 필요시 서버 페이지네이션 재검토)

---

### 20. 메모리 사용량 증가

**문제 요약**:  
전체 데이터를 클라이언트 메모리에 보관. 대용량 데이터 시 메모리 사용량 증가

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 저사양 디바이스에서 성능 저하
- 브라우저 메모리 부족으로 크래시 가능 (드묾)

**발생 조건**:  
- 프로젝트 수가 매우 많을 때 (1000개 이상)
- 저사양 모바일 디바이스

**지금 당장 조치 필요**: ⚠️ **모니터링 필요**  
**조치 레벨**: **프론트 레벨** (가상화 또는 페이지네이션 고려)

---

### 21. 필터링/정렬 연산이 메인 스레드 블로킹

**문제 요약**:  
`useMemo`로 필터링하지만, 대용량 데이터에서 연산 시간이 길어질 수 있음

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- UI 프리징 발생 가능
- 사용자 입력 지연

**발생 조건**:  
- 프로젝트 수가 매우 많을 때
- 복잡한 필터링 조건

**지금 당장 조치 필요**: ⚠️ **모니터링 필요**  
**조치 레벨**: **프론트 레벨** (Web Worker 고려 또는 최적화)

---

### 22. 페이지네이션 UI가 데이터와 동기화되지 않을 수 있음

**문제 요약**:  
필터링 결과가 변경되어도 페이지네이션 UI가 즉시 업데이트되지 않을 수 있음 (React 렌더링 사이클)

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- 사용자가 존재하지 않는 페이지를 보고 있을 수 있음
- 페이지 번호와 실제 데이터 불일치

**발생 조건**:  
- 필터 변경 시
- 검색어 변경 시

**지금 당장 조치 필요**: ⚠️ **권장**  
**조치 레벨**: **프론트 레벨** (상태 동기화 강화)

---

## 📋 배포 환경 차이점

### 23. Vercel 빌드 환경과 로컬 환경 차이

**문제 요약**:  
로컬에서는 정상 동작하지만 Vercel 빌드 환경에서 다르게 동작할 수 있음

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- Node.js 버전 차이
- 빌드 도구 버전 차이
- 환경 변수 주입 타이밍 차이

**발생 조건**:  
- 빌드 설정 불일치
- 환경 변수 설정 누락

**지금 당장 조치 필요**: ✅ **YES**  
**조치 레벨**: **설정 레벨** (Vercel 빌드 설정 확인)

---

### 24. 브라우저 호환성 문제

**문제 요약**:  
최신 JavaScript 기능 사용 시 구형 브라우저에서 동작하지 않을 수 있음

**왜 Vercel 배포 시 문제가 될 수 있는지**:  
- Vite는 기본적으로 최신 브라우저 타겟
- 구형 브라우저 사용자 접근 불가

**발생 조건**:  
- 구형 브라우저 사용 시

**지금 당장 조치 필요**: ⚠️ **모니터링 필요**  
**조치 레벨**: **설정 레벨** (브라우저 타겟 설정 확인)

---

## 🎯 우선순위별 조치 권장사항

### 즉시 조치 필요 (배포 전 필수)
1. ✅ 환경 변수 설정 확인 및 검증 로직 추가 (#1, #2, #3)
2. ✅ Vercel 빌드 설정 확인 (#23)

### 배포 후 모니터링 필요
3. ⚠️ 전체 데이터 fetch 성능 모니터링 (#7, #19, #20, #21)
4. ⚠️ 에러 발생률 모니터링 (#4)

### 점진적 개선 권장
5. ⚠️ React Query Devtools 프로덕션 제거 (#5, #16)
6. ⚠️ 에러 처리 개선 (#4, #17)
7. ⚠️ 로딩 상태 처리 개선 (#12)
8. ⚠️ console.log 제거 (#18)
9. ⚠️ UX 개선 (#13, #14, #22)

---

## 📝 체크리스트

배포 전 확인 사항:
- [ ] Vercel 환경 변수 설정: `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY`, `VITE_FRONTEND_URL`
- [ ] 환경 변수 값 검증 (빈 문자열 아님)
- [ ] 빌드 성공 확인
- [ ] 프로덕션 빌드에서 React Query Devtools 제거 확인
- [ ] 에러 핸들링 테스트
- [ ] 네트워크 오류 시나리오 테스트
- [ ] 대용량 데이터 시나리오 테스트 (가능한 경우)

---

**보고서 작성일**: 2025-01-XX  
**다음 점검 권장일**: 배포 후 1주일 내

