{
  "project": {
    "name": "Tasko 내부 협업툴",
    "type": "CSR React Application",
    "tech_stack": [
      "React 19.1.0",
      "TypeScript",
      "Supabase",
      "React Query",
      "Zustand",
      "React Router",
      "Tailwind CSS",
      "Radix UI"
    ],
    "description": "회사 내부 업무 할당, 진행, 승인 및 커뮤니케이션을 한 곳에서 관리하기 위한 협업 플랫폼"
  },
  "assumptions": [
    "Supabase 프로젝트가 이미 생성되어 있고, 기본 설정이 완료되어 있음",
    "Gmail SMTP 계정 및 앱 비밀번호가 준비되어 있음",
    "Vercel 배포 계정이 준비되어 있음",
    "개발 환경에 Node.js 18+ 및 npm이 설치되어 있음"
  ],
  "questions_to_report": [
    {
      "question": "프로젝트 완료 여부 계산 로직의 정확한 기준이 무엇인가? (Task가 모두 APPROVED 상태면 완료인지, 또는 다른 조건이 있는지)",
      "impact": ["Task 4: 프로젝트 완료 여부 표시 UI 구현", "Task 5: 프로젝트 삭제 권한 검증 로직"]
    },
    {
      "question": "프로젝트 참여자 삭제 시 '진행중인 Task'의 정확한 정의는 무엇인가? (task_status != 'APPROVED'만 확인하면 되는지, 또는 다른 상태도 포함되는지)",
      "impact": ["Task 4: 프로젝트 참여자 삭제 검증 로직"]
    },
    {
      "question": "파일 업로드 시 Storage 버킷 권한 정책의 세부 설정은 무엇인가? (Public 버킷인지, RLS 정책이 필요한지)",
      "impact": ["Task 7: 파일 업로드/다운로드 기능"]
    },
    {
      "question": "이메일 발송 실패 시 재시도 로직의 구체적인 정책은 무엇인가? (최대 재시도 횟수, 재시도 간격 등)",
      "impact": ["Task 8: Edge Function 이메일 발송 로직"]
    },
    {
      "question": "프로필 이미지 업로드 시 Storage 버킷 경로 구조는 무엇인가? (예: avatars/{userId}/{filename})",
      "impact": ["Task 2: 프로필 이미지 업로드 기능"]
    },
    {
      "question": "Task 상태 변경 시 Optimistic Update 실패 시 롤백 전략의 구체적인 UX는 무엇인가? (에러 토스트만 표시하는지, 확인 다이얼로그가 필요한지)",
      "impact": ["Task 5: Task 상태 변경 Optimistic Update 구현"]
    }
  ],
  "tasks": [
    {
      "id": 1,
      "status": "done",
      "title": "프로젝트 초기 설정 및 인프라 구축",
      "description": "프로젝트의 기본 구조를 설정하고 필수 라이브러리를 설치하며, 개발 환경을 구성한다.",
      "details": "Vite 기반 React CSR 프로젝트 초기화, TypeScript 설정, 필수 라이브러리 설치(React Query, Zustand, React Router, Supabase Client 등), 기본 폴더 구조 생성, 환경 변수 설정, Vercel 배포 설정",
      "acceptance_criteria": [
        "프로젝트가 Vite로 정상 빌드되고 개발 서버가 실행됨",
        "모든 필수 라이브러리가 package.json에 설치되어 있음",
        "TypeScript 컴파일 에러가 없음",
        "환경 변수 파일(.env.local)이 생성되고 gitignore에 포함됨",
        "Vercel 배포 설정 파일(vercel.json)이 생성됨",
        "기본 폴더 구조(src/api, src/components, src/hooks, src/pages, src/lib, src/store, src/schemas)가 생성됨"
      ],
      "test_plan": [
        "단위 테스트: npm run build 명령어로 빌드 성공 확인",
        "통합 테스트: npm run dev로 개발 서버 실행 및 브라우저 접속 확인",
        "E2E 테스트: Vercel에 배포하여 프로덕션 환경에서 정상 동작 확인"
      ],
      "dependencies": [],
      "risks": [
        "환경 변수 누락으로 인한 런타임 에러",
        "라이브러리 버전 호환성 문제",
        "Vercel 배포 설정 오류로 인한 라우팅 실패"
      ],
      "sub_tasks": [
        {
          "id": "1.1",
          "title": "Vite React TypeScript 프로젝트 초기화",
          "detailed_steps": [
            "npm create vite@latest tasko-project -- --template react-ts 실행",
            "프로젝트 디렉토리로 이동 후 npm install 실행",
            "package.json 확인 및 필요 시 수정"
          ],
          "expected_output": [
            "프로젝트 루트 디렉토리 생성",
            "package.json 파일 생성",
            "기본 TypeScript 설정 파일 생성"
          ],
          "validation_steps": ["npm run dev 실행하여 개발 서버가 정상 동작하는지 확인"],
          "notes": "⚠️ 프로젝트가 이미 생성되어 있으므로 이 단계는 완료된 것으로 간주됨"
        },
        {
          "id": "1.2",
          "title": "필수 라이브러리 설치",
          "detailed_steps": [
            "npm install @supabase/supabase-js@2.88.0",
            "npm install @tanstack/react-query@5.83.0",
            "npm install zustand@5.0.6",
            "npm install react-router-dom@7.7.0",
            "npm install react-hook-form@7.68.0 zod@4.2.1",
            "npm install @radix-ui/react-* (필요한 컴포넌트만)",
            "npm install tailwindcss@4.1.11 postcss autoprefixer",
            "npm install i18next react-i18next",
            "npm install -D @types/node"
          ],
          "expected_output": [
            "package.json에 모든 라이브러리 추가됨",
            "node_modules에 라이브러리 설치됨"
          ],
          "validation_steps": ["package.json 파일 확인", "npm install 실행 시 에러 없음 확인"]
        },
        {
          "id": "1.3",
          "title": "프로젝트 폴더 구조 생성",
          "detailed_steps": [
            "src/api/ 디렉토리 생성",
            "src/components/common/, layout/, ui/, dialog/, project/, task/, select/ 디렉토리 생성",
            "src/hooks/queries/, mutations/ 디렉토리 생성",
            "src/pages/ 디렉토리 생성",
            "src/lib/, src/store/, src/schemas/ 디렉토리 생성",
            "supabase/migrations/, supabase/functions/ 디렉토리 생성"
          ],
          "expected_output": ["모든 디렉토리가 생성됨"],
          "validation_steps": ["디렉토리 구조 확인", "파일 탐색기에서 폴더 구조 확인"]
        },
        {
          "id": "1.4",
          "title": "환경 변수 설정 파일 생성",
          "detailed_steps": [
            ".env.local 파일 생성",
            "VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY 변수 추가",
            ".gitignore에 .env.local 추가 확인"
          ],
          "expected_output": [".env.local 파일 생성", ".gitignore에 .env.local 포함됨"],
          "validation_steps": [".env.local 파일 존재 확인", ".gitignore 내용 확인"]
        },
        {
          "id": "1.5",
          "title": "Vercel 배포 설정",
          "detailed_steps": [
            "vercel.json 파일 생성",
            "SPA 라우팅을 위한 rewrites 설정 추가: { \"source\": \"/(.*)\", \"destination\": \"/\" }"
          ],
          "expected_output": ["vercel.json 파일 생성"],
          "validation_steps": ["vercel.json 파일 내용 확인", "JSON 문법 검증"]
        }
      ]
    },
    {
      "id": 2,
      "status": "pending",
      "title": "인증 및 사용자 관리 시스템 구축",
      "description": "Supabase Auth를 활용한 인증 시스템과 프로필 관리 기능을 구현한다.",
      "details": "Supabase Client 초기화, 로그인/회원가입/비밀번호 재설정 페이지, 프로필 설정 페이지, 프로필 조회/수정 API, 프로필 이미지 업로드, 세션 관리(Zustand), 인증 가드 레이아웃 컴포넌트",
      "acceptance_criteria": [
        "사용자가 이메일/비밀번호로 회원가입 및 로그인 가능",
        "비밀번호 재설정 기능이 정상 동작함",
        "프로필 설정 페이지에서 이름, 프로필 이미지 설정 가능",
        "프로필 미설정 시 프로필 설정 페이지로 리다이렉트됨",
        "세션이 Zustand로 관리되고 전역에서 접근 가능함",
        "인증되지 않은 사용자는 로그인 페이지만 접근 가능함"
      ],
      "test_plan": [
        "단위 테스트: API 함수들이 정상적으로 Supabase와 통신하는지 확인",
        "통합 테스트: 로그인 → 프로필 설정 → 대시보드 접근 플로우 테스트",
        "E2E 테스트: 브라우저에서 전체 인증 플로우 테스트"
      ],
      "dependencies": [1],
      "risks": [
        "Supabase Auth 설정 오류로 인한 인증 실패",
        "세션 관리 로직 오류로 인한 무한 리다이렉트",
        "프로필 이미지 업로드 시 Storage 권한 오류"
      ],
      "sub_tasks": [
        {
          "id": "2.1",
          "title": "Supabase Client 초기화",
          "detailed_steps": [
            "src/lib/supabase.ts 파일 생성",
            "createClient 함수로 Supabase 클라이언트 인스턴스 생성",
            "환경 변수에서 VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY 읽기",
            "export const supabase = createClient(...) 형태로 export"
          ],
          "expected_output": [
            "src/lib/supabase.ts 파일 생성",
            "Supabase 클라이언트 인스턴스 export됨"
          ],
          "validation_steps": ["파일 내용 확인", "다른 파일에서 import하여 사용 가능한지 확인"]
        },
        {
          "id": "2.2",
          "title": "인증 API 함수 구현",
          "detailed_steps": [
            "src/api/auth.ts 파일 생성",
            "signIn(email, password) 함수 구현: supabase.auth.signInWithPassword()",
            "signUp(email, password) 함수 구현: supabase.auth.signUp()",
            "signOut() 함수 구현: supabase.auth.signOut()",
            "resetPassword(email) 함수 구현: supabase.auth.resetPasswordForEmail()",
            "getSession() 함수 구현: supabase.auth.getSession()",
            "onAuthStateChange() 콜백 등록 함수 구현"
          ],
          "expected_output": ["src/api/auth.ts 파일 생성", "모든 인증 관련 함수 구현됨"],
          "validation_steps": ["각 함수가 정상적으로 동작하는지 테스트", "에러 처리 로직 확인"]
        },
        {
          "id": "2.3",
          "title": "세션 상태 관리 (Zustand)",
          "detailed_steps": [
            "src/store/session.ts 파일 생성",
            "Zustand 스토어 정의: isLoaded, session 상태",
            "useSession(), useSetSession() 훅 export",
            "SessionProvider 컴포넌트 생성 (src/provider/session-provider.tsx)",
            "SessionProvider에서 onAuthStateChange 구독하여 세션 업데이트"
          ],
          "expected_output": ["src/store/session.ts 파일 생성", "SessionProvider 컴포넌트 생성"],
          "validation_steps": [
            "세션이 정상적으로 업데이트되는지 확인",
            "전역에서 세션 접근 가능한지 확인"
          ]
        },
        {
          "id": "2.4",
          "title": "로그인/회원가입/비밀번호 재설정 페이지 구현",
          "detailed_steps": [
            "src/pages/sign-in-page.tsx 생성",
            "src/pages/signup-page.tsx 생성",
            "src/pages/forgot-password-page.tsx 생성",
            "src/pages/reset-password-page.tsx 생성",
            "각 페이지에 React Hook Form + Zod 스키마 적용",
            "src/components/form/sign-in-form.tsx, signup-form.tsx, forgot-password-form.tsx, reset-password-form.tsx 생성",
            "폼 제출 시 해당 API 함수 호출 및 에러 처리"
          ],
          "expected_output": ["모든 인증 관련 페이지 및 폼 컴포넌트 생성"],
          "validation_steps": [
            "각 페이지가 정상적으로 렌더링되는지 확인",
            "폼 제출 시 정상 동작하는지 확인"
          ]
        },
        {
          "id": "2.5",
          "title": "프로필 API 함수 구현",
          "detailed_steps": [
            "src/api/profile.ts 파일 생성",
            "getCurrentProfile() 함수 구현: profiles 테이블에서 현재 사용자 프로필 조회",
            "updateProfile(data) 함수 구현: profiles 테이블 업데이트",
            "updateAvatar(file) 함수 구현: Storage에 이미지 업로드 후 avatar_url 업데이트"
          ],
          "expected_output": ["src/api/profile.ts 파일 생성", "프로필 관련 API 함수 구현됨"],
          "validation_steps": ["API 함수들이 정상적으로 동작하는지 테스트"]
        },
        {
          "id": "2.6",
          "title": "프로필 설정 페이지 구현",
          "detailed_steps": [
            "src/pages/profile-setup-page.tsx 생성",
            "src/components/form/profile-setup-form.tsx 생성",
            "이름 입력 필드, 프로필 이미지 업로드 필드 포함",
            "프로필 설정 완료 시 profile_completed = true로 업데이트",
            "설정 완료 후 대시보드로 리다이렉트"
          ],
          "expected_output": ["프로필 설정 페이지 및 폼 컴포넌트 생성"],
          "validation_steps": [
            "프로필 설정이 정상적으로 완료되는지 확인",
            "리다이렉트가 정상 동작하는지 확인"
          ]
        },
        {
          "id": "2.7",
          "title": "인증 가드 레이아웃 컴포넌트 구현",
          "detailed_steps": [
            "src/components/layout/guest-only-layout.tsx 생성: 인증되지 않은 사용자만 접근 가능",
            "src/components/layout/member-only-layout.tsx 생성: 인증된 사용자만 접근 가능",
            "src/components/layout/profile-required-layout.tsx 생성: 프로필 설정 완료된 사용자만 접근 가능",
            "각 레이아웃에서 세션 및 프로필 상태 확인 후 조건부 리다이렉트"
          ],
          "expected_output": ["모든 인증 가드 레이아웃 컴포넌트 생성"],
          "validation_steps": ["인증 상태에 따라 정상적으로 리다이렉트되는지 확인"]
        }
      ]
    },
    {
      "id": 3,
      "status": "pending",
      "title": "데이터베이스 스키마 및 RLS 정책 설정",
      "description": "Supabase 데이터베이스에 필요한 테이블, ENUM 타입, RLS 정책, 트리거를 생성한다.",
      "details": "profiles, projects, project_participants, tasks, messages 테이블 생성, task_status, task_category, message_type ENUM 타입 생성, 모든 테이블에 RLS 정책 설정, Task 생성/상태 변경 시 트리거 생성(이메일 발송, 시스템 메시지 생성), 읽음 처리 함수 생성",
      "acceptance_criteria": [
        "모든 테이블이 정상적으로 생성되고 관계가 설정됨",
        "ENUM 타입이 정상적으로 생성됨",
        "모든 테이블에 RLS가 활성화되어 있음",
        "RLS 정책이 기획서 명세대로 정확히 구현됨",
        "트리거가 정상적으로 동작하여 이메일 발송 및 시스템 메시지 생성됨",
        "읽음 처리 함수가 정상적으로 동작함"
      ],
      "test_plan": [
        "단위 테스트: 각 마이그레이션 파일이 정상적으로 실행되는지 확인",
        "통합 테스트: RLS 정책이 정상적으로 동작하는지 확인 (Admin/Member 권한 테스트)",
        "E2E 테스트: 트리거가 정상적으로 동작하는지 확인 (Task 생성 시 이메일 발송 확인)"
      ],
      "dependencies": [1],
      "risks": [
        "RLS 정책 오류로 인한 데이터 접근 실패",
        "트리거 로직 오류로 인한 이메일 미발송",
        "외래키 제약조건 오류로 인한 데이터 삭제 실패"
      ],
      "sub_tasks": [
        {
          "id": "3.1",
          "title": "ENUM 타입 생성 마이그레이션",
          "detailed_steps": [
            "supabase/migrations/001_create_enums.sql 파일 생성",
            "CREATE TYPE task_status AS ENUM ('ASSIGNED', 'IN_PROGRESS', 'WAITING_CONFIRM', 'APPROVED', 'REJECTED')",
            "CREATE TYPE task_category AS ENUM ('REVIEW', 'CONTRACT', 'SPECIFICATION', 'APPLICATION')",
            "CREATE TYPE message_type AS ENUM ('USER', 'SYSTEM', 'FILE')",
            "마이그레이션 실행"
          ],
          "expected_output": ["ENUM 타입이 데이터베이스에 생성됨"],
          "validation_steps": ["Supabase Dashboard에서 ENUM 타입 확인"],
          "notes": "⚠️ 실제 마이그레이션 파일은 타임스탬프 형식(예: 20250101000000_create_enums.sql)을 사용함. 'FILE' 타입은 나중에 추가됨"
        },
        {
          "id": "3.2",
          "title": "profiles 테이블 생성 마이그레이션",
          "detailed_steps": [
            "supabase/migrations/002_create_profiles.sql 파일 생성",
            "CREATE TABLE profiles (id UUID PRIMARY KEY REFERENCES auth.users(id), email TEXT NOT NULL, full_name TEXT, role TEXT NOT NULL DEFAULT 'member', profile_completed BOOLEAN DEFAULT false, is_active BOOLEAN DEFAULT true, avatar_url TEXT, created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW())",
            "RLS 활성화: ALTER TABLE profiles ENABLE ROW LEVEL SECURITY",
            "RLS 정책 생성: SELECT (본인 또는 Admin), UPDATE (본인만)",
            "트리거 생성: 프로필 생성 시 auth.users에서 자동 생성"
          ],
          "expected_output": ["profiles 테이블 생성", "RLS 정책 설정됨"],
          "validation_steps": ["테이블 구조 확인", "RLS 정책 확인"]
        },
        {
          "id": "3.3",
          "title": "projects 테이블 생성 마이그레이션",
          "detailed_steps": [
            "supabase/migrations/003_create_projects.sql 파일 생성",
            "CREATE TABLE projects (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), title TEXT NOT NULL, client_name TEXT NOT NULL, due_date TIMESTAMPTZ, created_by UUID NOT NULL REFERENCES auth.users(id), created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW())",
            "RLS 활성화",
            "RLS 정책 생성: SELECT (Admin 또는 참여자), INSERT/UPDATE/DELETE (Admin만)"
          ],
          "expected_output": ["projects 테이블 생성", "RLS 정책 설정됨"],
          "validation_steps": ["테이블 구조 확인", "RLS 정책 확인"]
        },
        {
          "id": "3.4",
          "title": "project_participants 테이블 생성 마이그레이션",
          "detailed_steps": [
            "supabase/migrations/004_create_project_participants.sql 파일 생성",
            "CREATE TABLE project_participants (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE, user_id UUID NOT NULL REFERENCES profiles(id) ON DELETE CASCADE, invited_by UUID NOT NULL REFERENCES profiles(id), invited_at TIMESTAMPTZ NOT NULL DEFAULT NOW(), created_at TIMESTAMPTZ NOT NULL DEFAULT NOW(), UNIQUE(project_id, user_id))",
            "인덱스 생성: idx_project_participants_project_id, idx_project_participants_user_id",
            "RLS 활성화",
            "RLS 정책 생성: SELECT (참여자 또는 Admin), INSERT/DELETE (Admin만)"
          ],
          "expected_output": [
            "project_participants 테이블 생성",
            "인덱스 생성됨",
            "RLS 정책 설정됨"
          ],
          "validation_steps": ["테이블 구조 확인", "인덱스 확인", "RLS 정책 확인"]
        },
        {
          "id": "3.5",
          "title": "tasks 테이블 생성 마이그레이션",
          "detailed_steps": [
            "supabase/migrations/005_create_tasks.sql 파일 생성",
            "CREATE TABLE tasks (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), project_id UUID NOT NULL REFERENCES projects(id) ON DELETE CASCADE, title TEXT NOT NULL, description TEXT, assigner_id UUID REFERENCES profiles(id), assignee_id UUID REFERENCES profiles(id), task_status task_status NOT NULL DEFAULT 'ASSIGNED', task_category task_category NOT NULL DEFAULT 'REVIEW', due_date TIMESTAMPTZ, created_at TIMESTAMPTZ DEFAULT NOW(), updated_at TIMESTAMPTZ DEFAULT NOW())",
            "RLS 활성화",
            "RLS 정책 생성: SELECT (프로젝트 참여자 또는 Admin), INSERT (참여자 또는 Admin), UPDATE/DELETE (지시자만)"
          ],
          "expected_output": ["tasks 테이블 생성", "RLS 정책 설정됨"],
          "validation_steps": ["테이블 구조 확인", "RLS 정책 확인"]
        },
        {
          "id": "3.6",
          "title": "messages 테이블 생성 마이그레이션",
          "detailed_steps": [
            "supabase/migrations/006_create_messages.sql 파일 생성",
            "CREATE TABLE messages (id UUID PRIMARY KEY DEFAULT gen_random_uuid(), task_id UUID NOT NULL REFERENCES tasks(id) ON DELETE CASCADE, user_id UUID NOT NULL REFERENCES profiles(id), content TEXT, message_type message_type NOT NULL DEFAULT 'USER', read_by JSONB DEFAULT '[]'::jsonb, file_url TEXT, file_name TEXT, file_type TEXT, file_size BIGINT, deleted_at TIMESTAMPTZ, created_at TIMESTAMPTZ DEFAULT NOW())",
            "RLS 활성화",
            "RLS 정책 생성: SELECT/INSERT (Task 접근 권한 필요), UPDATE/DELETE (본인 작성 USER 메시지만)"
          ],
          "expected_output": ["messages 테이블 생성", "RLS 정책 설정됨"],
          "validation_steps": ["테이블 구조 확인", "RLS 정책 확인"]
        },
        {
          "id": "3.7",
          "title": "Task 생성 시 트리거 생성",
          "detailed_steps": [
            "supabase/migrations/007_create_task_triggers.sql 파일 생성",
            "trigger_send_task_created_email 트리거 생성: Task INSERT 시 Edge Function 호출",
            "trigger_create_task_created_system_message 트리거 생성: Task INSERT 시 SYSTEM 메시지 생성",
            "pg_net 확장 사용하여 비동기 HTTP 요청"
          ],
          "expected_output": ["트리거가 생성됨"],
          "validation_steps": [
            "트리거가 정상적으로 동작하는지 테스트",
            "Task 생성 시 이메일 발송 확인"
          ]
        },
        {
          "id": "3.8",
          "title": "Task 상태 변경 시 트리거 생성",
          "detailed_steps": [
            "supabase/migrations/008_create_task_status_triggers.sql 파일 생성",
            "trigger_send_task_status_change_email 트리거 생성: 특정 상태 전환 시에만 Edge Function 호출",
            "trigger_create_task_status_change_system_message 트리거 생성: 모든 상태 변경 시 SYSTEM 메시지 생성",
            "상태 전환별 수신자 로직 구현"
          ],
          "expected_output": ["트리거가 생성됨"],
          "validation_steps": [
            "트리거가 정상적으로 동작하는지 테스트",
            "상태 변경 시 이메일 발송 확인"
          ]
        },
        {
          "id": "3.9",
          "title": "읽음 처리 함수 생성",
          "detailed_steps": [
            "supabase/migrations/009_create_message_read_functions.sql 파일 생성",
            "mark_message_as_read(message_id, user_id) 함수 생성: read_by JSONB 배열에 사용자 ID 추가",
            "mark_all_messages_as_read(task_id, user_id) 함수 생성: Task의 모든 메시지 읽음 처리"
          ],
          "expected_output": ["읽음 처리 함수가 생성됨"],
          "validation_steps": ["함수가 정상적으로 동작하는지 테스트"]
        },
        {
          "id": "3.10",
          "title": "Storage 버킷 생성 및 권한 설정",
          "detailed_steps": [
            "Supabase Dashboard에서 task-files 버킷 생성 (Public)",
            "Storage 정책 생성: 업로드/다운로드 권한 설정",
            "avatars 버킷 생성 (Public, 프로필 이미지용)"
          ],
          "expected_output": ["Storage 버킷이 생성되고 권한이 설정됨"],
          "validation_steps": ["버킷이 정상적으로 생성되었는지 확인", "권한 정책 확인"],
          "notes": "✅ project_participants 테이블은 Task 3.4에서 생성됨"
        }
      ]
    },
    {
      "id": 4,
      "status": "done",
      "title": "프로젝트 관리 기능 구현",
      "description": "프로젝트 CRUD, 참여자 관리, 프로젝트 목록 조회 기능을 구현한다.",
      "details": "프로젝트 API 함수(getProjects, getProjectById, createProject, updateProject, deleteProject, getProjectParticipants, addProjectParticipant, removeProjectParticipant), React Query 훅(useProjects, useProject, useCreateProject 등), 프로젝트 생성/수정/삭제 다이얼로그, 참여자 관리 다이얼로그, 프로젝트 목록 페이지(Admin: 전체 프로젝트, Member: 참여 프로젝트만)",
      "acceptance_criteria": [
        "Admin이 프로젝트를 생성/수정/삭제할 수 있음",
        "프로젝트 생성 시 초대 사용자 선택 필수 (관리자 제외 1명 이상)",
        "프로젝트 생성 시 관리자가 자동으로 참여자로 추가됨",
        "프로젝트 삭제는 모든 Task가 APPROVED 상태이거나 Task가 없는 경우만 가능",
        "참여자 추가/삭제가 정상적으로 동작함",
        "참여자 삭제 시 진행중인 Task 확인 로직이 정상 동작함",
        "프로젝트 목록이 권한에 따라 필터링되어 표시됨"
      ],
      "test_plan": [
        "단위 테스트: API 함수들이 정상적으로 동작하는지 확인",
        "통합 테스트: 프로젝트 생성 → 참여자 추가 → Task 생성 플로우 테스트",
        "E2E 테스트: 브라우저에서 프로젝트 관리 기능 전체 테스트"
      ],
      "dependencies": [2, 3],
      "risks": [
        "RLS 정책과 애플리케이션 로직 불일치로 인한 권한 오류",
        "참여자 삭제 시 진행중인 Task 확인 로직 오류",
        "프로젝트 삭제 조건 검증 로직 오류"
      ],
      "sub_tasks": [
        {
          "id": "4.1",
          "title": "프로젝트 API 함수 구현",
          "detailed_steps": [
            "src/api/project.ts 파일 생성",
            "getProjects() 함수 구현: 전체 프로젝트 조회 (RLS 자동 필터링)",
            "getProjectById(id) 함수 구현: 단일 프로젝트 조회",
            "createProject(data) 함수 구현: 프로젝트 생성 및 참여자 추가",
            "updateProject(id, data) 함수 구현: 프로젝트 정보 수정",
            "deleteProject(id) 함수 구현: 삭제 조건 검증 후 삭제",
            "getProjectParticipants(id) 함수 구현: 참여자 목록 조회",
            "addProjectParticipant(projectId, userId) 함수 구현: 참여자 추가",
            "removeProjectParticipant(projectId, userId) 함수 구현: 진행중인 Task 확인 후 삭제"
          ],
          "expected_output": ["src/api/project.ts 파일 생성", "모든 프로젝트 관련 API 함수 구현됨"],
          "validation_steps": ["각 함수가 정상적으로 동작하는지 테스트", "에러 처리 로직 확인"]
        },
        {
          "id": "4.2",
          "title": "프로젝트 React Query 훅 구현",
          "detailed_steps": [
            "src/hooks/queries/use-projects.ts 파일 생성",
            "useProjects() 훅 구현: staleTime 30초 설정",
            "useProject(id) 훅 구현",
            "src/hooks/mutations/use-project.ts 파일 생성",
            "useCreateProject() 훅 구현: 성공 시 캐시 무효화",
            "useUpdateProject() 훅 구현: 성공 시 캐시 무효화",
            "useDeleteProject() 훅 구현: 성공 시 캐시 무효화"
          ],
          "expected_output": ["프로젝트 관련 React Query 훅 구현됨"],
          "validation_steps": [
            "훅이 정상적으로 동작하는지 테스트",
            "캐시 무효화가 정상 동작하는지 확인"
          ]
        },
        {
          "id": "4.3",
          "title": "프로젝트 생성 다이얼로그 구현",
          "detailed_steps": [
            "src/components/dialog/project-form-dialog.tsx 생성",
            "React Hook Form + Zod 스키마 적용",
            "입력 필드: 기회, 고객명, 완료 예정일, 초대 사용자(다중 선택, 필수)",
            "초대 사용자 선택: 프로필 인증된 사용자, 활성 상태 사용자만 표시, 현재 로그인한 관리자 제외",
            "폼 제출 시 createProject API 호출 및 참여자 추가",
            "에러 처리 및 성공 메시지 표시"
          ],
          "expected_output": ["프로젝트 생성 다이얼로그 컴포넌트 생성"],
          "validation_steps": [
            "다이얼로그가 정상적으로 열리고 닫히는지 확인",
            "폼 제출 시 프로젝트가 생성되는지 확인"
          ]
        },
        {
          "id": "4.4",
          "title": "프로젝트 수정 다이얼로그 구현",
          "detailed_steps": [
            "프로젝트 생성 다이얼로그를 재사용하거나 별도 컴포넌트 생성",
            "기존 프로젝트 데이터로 폼 초기화",
            "수정 가능한 필드만 표시 (초대 사용자 필드는 제외)",
            "폼 제출 시 updateProject API 호출"
          ],
          "expected_output": ["프로젝트 수정 다이얼로그 컴포넌트 생성"],
          "validation_steps": [
            "다이얼로그가 정상적으로 동작하는지 확인",
            "프로젝트 정보가 정상적으로 수정되는지 확인"
          ]
        },
        {
          "id": "4.5",
          "title": "프로젝트 삭제 확인 다이얼로그 구현",
          "detailed_steps": [
            "src/components/dialog/project-delete-dialog.tsx 생성",
            "삭제 조건 검증: 모든 Task가 APPROVED 상태이거나 Task가 없는지 확인",
            "조건 불충족 시 에러 메시지 표시",
            "조건 충족 시 확인 다이얼로그 표시 후 삭제 실행"
          ],
          "expected_output": ["프로젝트 삭제 다이얼로그 컴포넌트 생성"],
          "validation_steps": [
            "삭제 조건 검증이 정상 동작하는지 확인",
            "프로젝트가 정상적으로 삭제되는지 확인"
          ]
        },
        {
          "id": "4.6",
          "title": "참여자 관리 다이얼로그 구현",
          "detailed_steps": [
            "src/components/dialog/participant-management-dialog.tsx 생성",
            "참여자 목록 표시 (useProjectParticipants 훅 사용)",
            "참여자 추가 버튼: 프로필 인증된 사용자, 활성 상태 사용자만 표시",
            "참여자 삭제 버튼: 진행중인 Task 확인 후 삭제 (프로젝트 생성자 제외)",
            "진행중인 Task가 있으면 삭제 불가 메시지 표시"
          ],
          "expected_output": ["참여자 관리 다이얼로그 컴포넌트 생성"],
          "validation_steps": [
            "참여자 추가/삭제가 정상 동작하는지 확인",
            "삭제 조건 검증이 정상 동작하는지 확인"
          ]
        },
        {
          "id": "4.7",
          "title": "프로젝트 목록 페이지 구현 (Admin용)",
          "detailed_steps": [
            "src/pages/index-page.tsx에서 Admin 분기 처리",
            "AdminDashboardPage 컴포넌트 생성",
            "useProjects() 훅으로 전체 프로젝트 조회",
            "클라이언트 사이드 검색/필터링/정렬 구현",
            "클라이언트 사이드 페이지네이션 구현",
            "프로젝트 생성 버튼 표시",
            "프로젝트 수정/삭제 버튼 표시"
          ],
          "expected_output": ["Admin용 프로젝트 목록 페이지 구현"],
          "validation_steps": [
            "전체 프로젝트가 표시되는지 확인",
            "검색/필터링/페이지네이션이 정상 동작하는지 확인"
          ],
          "notes": "⚠️ 실제로는 Task 6에서 역할별 대시보드가 구현됨. 이 sub_task는 Task 6과 중복될 수 있음"
        },
        {
          "id": "4.8",
          "title": "프로젝트 목록 페이지 구현 (Member용)",
          "detailed_steps": [
            "MemberDashboardPage 컴포넌트 생성",
            "useProjects() 훅으로 참여 프로젝트만 조회 (RLS 자동 필터링)",
            "클라이언트 사이드 검색/필터링 구현",
            "프로젝트 카드 형태로 표시",
            "프로젝트 완료 여부 표시 (대기중/진행중/완료)",
            "프로젝트 상세 보기 버튼만 표시"
          ],
          "expected_output": ["Member용 프로젝트 목록 페이지 구현"],
          "validation_steps": [
            "참여 프로젝트만 표시되는지 확인",
            "프로젝트 완료 여부가 정상 표시되는지 확인"
          ],
          "notes": "⚠️ 실제로는 Task 6에서 역할별 대시보드가 구현됨. 이 sub_task는 Task 6과 중복될 수 있음"
        }
      ]
    },
    {
      "id": 5,
      "status": "pending",
      "title": "Task 관리 기능 구현",
      "description": "Task CRUD, 상태 변경, 칸반 보드 UI를 구현한다.",
      "details": "Task API 함수(getTasksByProjectId, getTaskById, createTask, updateTask, updateTaskStatus, deleteTask), React Query 훅(useTasks, useTask, useCreateTask 등), Task 생성/수정/삭제 다이얼로그, 상태 변경 다이얼로그, 칸반 보드 컴포넌트(4개 컬럼), Task 카드 컴포넌트, Optimistic Updates 구현",
      "acceptance_criteria": [
        "프로젝트 참여자가 Task를 생성할 수 있음",
        "Task 생성 시 카테고리 필수 선택 (생성 후 변경 불가)",
        "Task 생성 시 assigner는 자동으로 현재 로그인한 사용자로 설정",
        "Task 수정/삭제는 지시자만 가능",
        "Task 상태 변경은 지시자만 가능 (Optimistic Update 적용)",
        "칸반 보드에 4개 컬럼(검토/계약/명세서/출원)이 표시됨",
        "각 컬럼에 해당 카테고리의 Task가 표시됨",
        "상태 변경 시 즉시 UI 반영됨 (깜빡임 없음)"
      ],
      "test_plan": [
        "단위 테스트: API 함수들이 정상적으로 동작하는지 확인",
        "통합 테스트: Task 생성 → 상태 변경 플로우 테스트",
        "E2E 테스트: 브라우저에서 Task 관리 기능 전체 테스트",
        "성능 테스트: Optimistic Update가 정상 동작하는지 확인"
      ],
      "dependencies": [3, 4],
      "risks": [
        "Optimistic Update 롤백 로직 오류",
        "상태 전환 유효성 검증 로직 오류",
        "칸반 보드 렌더링 성능 이슈"
      ],
      "sub_tasks": [
        {
          "id": "5.1",
          "title": "Task API 함수 구현",
          "detailed_steps": [
            "src/api/task.ts 파일 생성",
            "getTasksByProjectId(projectId) 함수 구현: 프로젝트별 Task 목록 조회 (assigner/assignee 프로필 JOIN)",
            "getTaskById(id) 함수 구현: 단일 Task 조회 (프로필 JOIN)",
            "createTask(data) 함수 구현: Task 생성 (title = description, assigner_id 자동 설정)",
            "updateTask(id, data) 함수 구현: Task 수정 (카테고리, assigner_id, assignee_id 수정 불가)",
            "updateTaskStatus(id, newStatus) 함수 구현: 상태 변경 (지시자 권한 검증)",
            "deleteTask(id) 함수 구현: Task 삭제 (지시자 권한 검증)"
          ],
          "expected_output": ["src/api/task.ts 파일 생성", "모든 Task 관련 API 함수 구현됨"],
          "validation_steps": ["각 함수가 정상적으로 동작하는지 테스트", "권한 검증 로직 확인"]
        },
        {
          "id": "5.2",
          "title": "Task React Query 훅 구현",
          "detailed_steps": [
            "src/hooks/queries/use-tasks.ts 파일 생성",
            "useTasks(projectId) 훅 구현: staleTime 30초 설정",
            "useTask(id) 훅 구현",
            "src/hooks/mutations/use-task.ts 파일 생성",
            "useCreateTask() 훅 구현: 성공 시 캐시 무효화",
            "useUpdateTask() 훅 구현: 성공 시 캐시 무효화",
            "useUpdateTaskStatus() 훅 구현: Optimistic Update 적용 (onMutate, onError 롤백)",
            "useDeleteTask() 훅 구현: 성공 시 캐시 무효화"
          ],
          "expected_output": ["Task 관련 React Query 훅 구현됨"],
          "validation_steps": [
            "훅이 정상적으로 동작하는지 테스트",
            "Optimistic Update가 정상 동작하는지 확인"
          ]
        },
        {
          "id": "5.3",
          "title": "Task 상태 전환 로직 구현",
          "detailed_steps": [
            "src/lib/task-status.ts 파일 생성",
            "getNextStatuses(currentStatus) 함수 구현: 현재 상태에서 가능한 다음 상태 반환",
            "canChangeStatus(currentStatus, newStatus) 함수 구현: 상태 전환 가능 여부 확인",
            "getStatusLabel(status) 함수 구현: 상태 한글 라벨 반환"
          ],
          "expected_output": ["Task 상태 전환 로직 구현됨"],
          "validation_steps": ["상태 전환 로직이 정확한지 확인"]
        },
        {
          "id": "5.4",
          "title": "Task 생성 다이얼로그 구현",
          "detailed_steps": [
            "src/components/dialog/task-form-dialog.tsx 생성",
            "React Hook Form + Zod 스키마 적용",
            "입력 필드: 업무 지시사항(description, 필수), 담당자(assignee, 필수), 마감일(due_date, 필수), 카테고리(task_category, 필수)",
            "담당자 선택: 프로젝트 참여자만 표시, 현재 사용자 제외, 프로필 인증된 사용자만",
            "카테고리 선택: 4개 옵션(검토/계약/명세서/출원) 중 선택",
            "마감일 검증: 오늘 이전 날짜 선택 불가, 프로젝트 완료 예정일 이전만 선택 가능",
            "폼 제출 시 createTask API 호출"
          ],
          "expected_output": ["Task 생성 다이얼로그 컴포넌트 생성"],
          "validation_steps": [
            "다이얼로그가 정상적으로 동작하는지 확인",
            "Task가 정상적으로 생성되는지 확인"
          ]
        },
        {
          "id": "5.5",
          "title": "Task 수정 다이얼로그 구현",
          "detailed_steps": [
            "Task 생성 다이얼로그를 재사용하거나 별도 컴포넌트 생성",
            "기존 Task 데이터로 폼 초기화",
            "수정 불가능한 필드 비활성화: 카테고리, 담당자, 지시자",
            "수정 가능한 필드: 업무 지시사항, 마감일",
            "폼 제출 시 updateTask API 호출"
          ],
          "expected_output": ["Task 수정 다이얼로그 컴포넌트 생성"],
          "validation_steps": [
            "다이얼로그가 정상적으로 동작하는지 확인",
            "Task 정보가 정상적으로 수정되는지 확인"
          ]
        },
        {
          "id": "5.6",
          "title": "Task 상태 변경 다이얼로그 구현",
          "detailed_steps": [
            "src/components/dialog/task-status-change-dialog.tsx 생성",
            "현재 상태에서 가능한 다음 상태 옵션 표시",
            "상태 변경 이유 입력 필드 (선택사항)",
            "확인 다이얼로그 표시",
            "폼 제출 시 updateTaskStatus API 호출 (Optimistic Update)"
          ],
          "expected_output": ["Task 상태 변경 다이얼로그 컴포넌트 생성"],
          "validation_steps": [
            "다이얼로그가 정상적으로 동작하는지 확인",
            "상태 변경이 즉시 UI에 반영되는지 확인"
          
        },
        {
          "id": "5.7",
          "title": "칸반 보드 컴포넌트 구현",
          "detailed_steps": [
            "src/components/task/kanban-board.tsx 생성",
            "4개 컬럼 컴포넌트 생성: KanbanColumn (검토/계약/명세서/출원)",
            "각 컬럼에 해당 카테고리의 Task 카드 표시",
            "컬럼별 '+ 새 테스크' 버튼 표시 (권한에 따라)",
            "검색 기능: Task 제목, 담당자명으로 필터링",
            "반응형 디자인: 모바일에서 x축 스크롤"
          ],
          "expected_output": ["칸반 보드 컴포넌트 생성"],
          "validation_steps": [
            "4개 컬럼이 정상적으로 표시되는지 확인",
            "Task가 올바른 컬럼에 표시되는지 확인",
            "검색 기능이 정상 동작하는지 확인"
          ],
          "notes": "⚠️ 칸반 보드는 실제로 Task 6에서 대시보드와 함께 구현됨. Task 5에서는 Task CRUD에 집중하고 칸반 보드는 Task 6에서 구현하는 것이 더 적절할 수 있음"
        },
        {
          "id": "5.8",
          "title": "Task 카드 컴포넌트 구현",
          "detailed_steps": [
            "src/components/task/task-card.tsx 생성",
            "Task 정보 표시: 제목, 담당자, 마감일, 상태",
            "수정/삭제 버튼 표시 (지시자만)",
            "상태 변경 버튼 표시 (지시자만)",
            "카드 클릭 시 Task 상세 페이지로 이동"
          ],
          "expected_output": ["Task 카드 컴포넌트 생성"],
          "validation_steps": [
            "Task 정보가 정상적으로 표시되는지 확인",
            "권한에 따라 버튼이 표시/숨김되는지 확인"
          ]
        },
        {
          "id": "5.9",
          "title": "프로젝트 상세 페이지 구현",
          "detailed_steps": [
            "src/pages/project-detail-page.tsx 생성",
            "프로젝트 정보 표시 (제목, 완료 여부 배지)",
            "참여자 관리 버튼 표시 (Admin만)",
            "칸반 보드 컴포넌트 렌더링",
            "검색 입력창 표시",
            "Task 생성/수정/삭제 다이얼로그 통합"
          ],
          "expected_output": ["프로젝트 상세 페이지 구현"],
          "validation_steps": [
            "프로젝트 정보가 정상적으로 표시되는지 확인",
            "칸반 보드가 정상 동작하는지 확인"
          ]
        }
      ]
    },
    {
      "id": 6,
      "status": "pending",
      "title": "대시보드 및 칸반 보드 UI 구현",
      "description": "역할별 대시보드, 칸반 보드 탭 전환, 프로젝트 카드 아코디언 기능을 구현한다.",
      "details": "IndexPage에서 역할별 분기(AdminDashboardPage, MemberDashboardPage), 칸반 보드 탭과 전체 프로젝트 탭 전환, 멤버 대시보드 칸반 보드(담당자/지시자 Task만 표시, APPROVED 제외), 프로젝트 카드 아코디언 기능, 클라이언트 사이드 검색/필터링",
      "acceptance_criteria": [
        "Admin과 Member가 각각 적절한 대시보드를 볼 수 있음",
        "칸반 보드 탭과 전체 프로젝트 탭 간 전환이 정상 동작함",
        "칸반 보드에 4개 컬럼이 표시되고 Task가 올바른 컬럼에 표시됨",
        "멤버 대시보드 칸반 보드에 담당자/지시자 Task만 표시됨 (APPROVED 제외)",
        "프로젝트 카드 아코디언이 정상 동작함",
        "검색 기능이 정상 동작함"
      ],
      "test_plan": [
        "단위 테스트: 컴포넌트가 정상적으로 렌더링되는지 확인",
        "통합 테스트: 탭 전환, 검색, 필터링이 정상 동작하는지 확인",
        "E2E 테스트: 브라우저에서 대시보드 전체 기능 테스트"
      ],
      "dependencies": [4, 5],
      "risks": [
        "탭 전환 시 상태 관리 오류",
        "프로젝트 카드 아코디언 렌더링 성능 이슈",
        "검색/필터링 로직 오류"
      ],
      "sub_tasks": [
        {
          "id": "6.1",
          "title": "역할별 대시보드 분기 로직 구현",
          "detailed_steps": [
            "src/pages/index-page.tsx 수정",
            "현재 사용자 역할 확인 (useCurrentProfile 훅 사용)",
            "Admin이면 AdminDashboardPage 렌더링",
            "Member이면 MemberDashboardPage 렌더링"
          ],
          "expected_output": ["역할별 대시보드 분기 로직 구현됨"],
          "validation_steps": ["Admin과 Member가 각각 적절한 대시보드를 보는지 확인"]
        },
        {
          "id": "6.2",
          "title": "Admin 대시보드 구현",
          "detailed_steps": [
            "AdminDashboardPage 컴포넌트 생성",
            "탭 버튼 구현: [칸반 보드] [전체 프로젝트]",
            "탭 상태 관리 (useState)",
            "칸반 보드 탭: 담당자/지시자 Task만 표시 (APPROVED 제외)",
            "전체 프로젝트 탭: 모든 프로젝트 목록 표시",
            "프로젝트 생성 버튼 표시"
          ],
          "expected_output": ["Admin 대시보드 구현"],
          "validation_steps": [
            "탭 전환이 정상 동작하는지 확인",
            "각 탭의 콘텐츠가 정상 표시되는지 확인"
          ]
        },
        {
          "id": "6.3",
          "title": "Member 대시보드 구현",
          "detailed_steps": [
            "MemberDashboardPage 컴포넌트 생성",
            "탭 버튼 구현: [칸반 보드] [전체 프로젝트]",
            "탭 상태 관리 (useState)",
            "칸반 보드 탭: 담당자/지시자 Task만 표시 (APPROVED 제외)",
            "전체 프로젝트 탭: 참여 프로젝트만 표시",
            "useTasksForMember() 훅 구현: 담당자인 Task 조회"
          ],
          "expected_output": ["Member 대시보드 구현"],
          "validation_steps": ["탭 전환이 정상 동작하는지 확인", "담당자 Task만 표시되는지 확인"]
        },
        {
          "id": "6.4",
          "title": "칸반 보드 탭 구현 (멤버 대시보드용)",
          "detailed_steps": [
            "칸반 보드 컴포넌트 재사용",
            "담당자/지시자 Task만 필터링 (task_status != 'APPROVED')",
            "프로젝트별로 Task 그룹화",
            "카테고리별로 Task 그룹화",
            "프로젝트 카드 생성 (같은 프로젝트의 여러 Task가 같은 컬럼에 있으면 아코디언으로 표시)"
          ],
          "expected_output": ["칸반 보드 탭 구현됨"],
          "validation_steps": ["Task가 올바르게 필터링되고 그룹화되는지 확인"]
        },
        {
          "id": "6.5",
          "title": "프로젝트 카드 컴포넌트 구현",
          "detailed_steps": [
            "src/components/project/project-card.tsx 생성",
            "프로젝트 정보 표시: 기회, 고객명, 완료 예정일, Task 개수",
            "아코디언 기능 구현: 같은 프로젝트의 여러 Task를 아코디언으로 표시",
            "기회 클릭 시 프로젝트 상세 페이지로 이동",
            "아코디언 펼치기/접기 기능"
          ],
          "expected_output": ["프로젝트 카드 컴포넌트 생성"],
          "validation_steps": [
            "프로젝트 정보가 정상 표시되는지 확인",
            "아코디언이 정상 동작하는지 확인"
          ]
        },
        {
          "id": "6.6",
          "title": "검색 기능 구현",
          "detailed_steps": [
            "검색 입력창 컴포넌트 생성",
            "useDebounce 훅 사용 (300ms)",
            "검색어로 Task/프로젝트 필터링 (기회, 고객명, Task 제목, 담당자명)",
            "검색 결과를 칸반 보드에 반영"
          ],
          "expected_output": ["검색 기능 구현됨"],
          "validation_steps": [
            "검색어 입력 시 실시간으로 필터링되는지 확인",
            "debounce가 정상 동작하는지 확인"
          ]
        },
        {
          "id": "6.7",
          "title": "클라이언트 사이드 페이지네이션 구현 (전체 프로젝트 탭용)",
          "detailed_steps": [
            "table-pagination 컴포넌트 재사용 또는 새로 생성",
            "필터링된 프로젝트 목록을 slice로 페이지네이션",
            "페이지 변경 시 즉시 반영 (서버 요청 없음)",
            "필터 변경 시 1페이지로 리셋"
          ],
          "expected_output": ["클라이언트 사이드 페이지네이션 구현됨"],
          "validation_steps": [
            "페이지네이션이 정상 동작하는지 확인",
            "필터 변경 시 페이지 리셋이 정상 동작하는지 확인"
          ]
        }
      ]
    },
    {
      "id": 7,
      "status": "pending",
      "title": "실시간 채팅 기능 구현",
      "description": "Task별 실시간 메시지, 파일 전송, 읽음 처리 기능을 구현한다.",
      "details": "메시지 API 함수(getMessagesByTaskId, createMessage, createMessageWithFiles, deleteMessage, markMessageAsRead), React Query 훅(useRealtimeMessages), 실시간 구독(useRealtimeMessages), 메시지 입력 컴포넌트, 파일 업로드/다운로드, 읽음 처리, 입력 중 표시(Broadcast)",
      "acceptance_criteria": [
        "메시지가 실시간으로 수신되고 표시됨",
        "파일 업로드/다운로드가 정상 동작함 (최대 10MB)",
        "읽음 처리가 정상 동작함",
        "입력 중 표시가 정상 동작함",
        "메시지 삭제가 정상 동작함 (본인 작성 USER 메시지만)",
        "SYSTEM 메시지와 USER 메시지가 구분되어 표시됨"
      ],
      "test_plan": [
        "단위 테스트: API 함수들이 정상적으로 동작하는지 확인",
        "통합 테스트: 메시지 전송 → 실시간 수신 플로우 테스트",
        "E2E 테스트: 브라우저에서 실시간 채팅 기능 전체 테스트 (두 브라우저에서 동시 테스트)"
      ],
      "dependencies": [3, 5],
      "risks": [
        "Realtime 구독 메모리 누수",
        "파일 업로드 실패 시 에러 처리",
        "읽음 처리 로직 오류"
      ],
      "sub_tasks": [
        {
          "id": "7.1",
          "title": "메시지 API 함수 구현",
          "detailed_steps": [
            "src/api/message.ts 파일 생성",
            "getMessagesByTaskId(taskId) 함수 구현: Task별 메시지 목록 조회 (프로필 JOIN)",
            "createMessage(taskId, content) 함수 구현: 텍스트 메시지 생성",
            "createMessageWithFiles(taskId, content, files) 함수 구현: 파일 업로드 후 메시지 생성",
            "deleteMessage(messageId) 함수 구현: 메시지 소프트 삭제",
            "markMessageAsRead(messageId, userId) 함수 구현: 읽음 처리 함수 호출",
            "markAllMessagesAsRead(taskId, userId) 함수 구현: 모든 메시지 읽음 처리"
          ],
          "expected_output": ["src/api/message.ts 파일 생성", "모든 메시지 관련 API 함수 구현됨"],
          "validation_steps": ["각 함수가 정상적으로 동작하는지 테스트"]
        },
        {
          "id": "7.2",
          "title": "파일 업로드 API 함수 구현",
          "detailed_steps": [
            "src/api/storage.ts 파일 생성",
            "uploadFile(bucket, file) 함수 구현: Storage에 파일 업로드",
            "getFileUrl(bucket, path) 함수 구현: 파일 다운로드 URL 생성",
            "deleteFile(bucket, path) 함수 구현: 파일 삭제",
            "파일 크기 검증 (10MB 제한)",
            "파일 형식 검증 (허용된 형식만)"
          ],
          "expected_output": ["src/api/storage.ts 파일 생성", "파일 업로드/다운로드 함수 구현됨"],
          "validation_steps": [
            "파일 업로드/다운로드가 정상 동작하는지 확인",
            "파일 크기/형식 검증이 정상 동작하는지 확인"
          ]
        },
        {
          "id": "7.3",
          "title": "실시간 메시지 구독 훅 구현",
          "detailed_steps": [
            "src/hooks/queries/use-realtime-messages.ts 파일 생성",
            "useRealtimeMessages(taskId, enabled, isPresent) 훅 구현",
            "Supabase Realtime 채널 구독: messages 테이블 INSERT/UPDATE/DELETE 이벤트",
            "이벤트 수신 시 React Query 캐시 업데이트 (invalidateQueries)",
            "useEffect cleanup에서 구독 해제",
            "isPresent 파라미터로 페이지 가시성 확인"
          ],
          "expected_output": ["실시간 메시지 구독 훅 구현됨"],
          "validation_steps": [
            "메시지가 실시간으로 수신되는지 확인",
            "구독 해제가 정상 동작하는지 확인"
          ]
        },
        {
          "id": "7.4",
          "title": "메시지 React Query 훅 구현",
          "detailed_steps": [
            "src/hooks/mutations/use-message.ts 파일 생성",
            "useCreateMessage() 훅 구현: 성공 시 캐시 무효화",
            "useCreateMessageWithFiles() 훅 구현: 파일 업로드 후 메시지 생성",
            "useDeleteMessage() 훅 구현: 성공 시 캐시 무효화"
          ],
          "expected_output": ["메시지 관련 React Query 훅 구현됨"],
          "validation_steps": ["훅이 정상적으로 동작하는지 테스트"]
        },
        {
          "id": "7.5",
          "title": "Task 상세 페이지 구현",
          "detailed_steps": [
            "src/pages/task-detail-page.tsx 생성",
            "Task 정보 카드 표시",
            "실시간 채팅 영역 구현",
            "메시지 목록 표시 (스크롤 가능)",
            "메시지 타입별 표시 (USER/SYSTEM/FILE)",
            "읽음 표시 표시",
            "자동 스크롤 (새 메시지 수신 시)"
          ],
          "expected_output": ["Task 상세 페이지 구현"],
          "validation_steps": [
            "Task 정보가 정상 표시되는지 확인",
            "메시지 목록이 정상 표시되는지 확인"
          ]
        },
        {
          "id": "7.6",
          "title": "메시지 입력 컴포넌트 구현",
          "detailed_steps": [
            "src/components/message/message-input.tsx 생성",
            "텍스트 입력 필드 (여러 줄 입력 가능, Shift+Enter: 줄바꿈, Enter: 전송)",
            "파일 첨부 버튼 (드래그 앤 드롭 지원)",
            "첨부 파일 미리보기 및 제거 기능",
            "전송 버튼 (텍스트 또는 파일이 있을 때 활성화)",
            "파일 업로드 진행 상태 표시"
          ],
          "expected_output": ["메시지 입력 컴포넌트 생성"],
          "validation_steps": [
            "메시지 입력이 정상 동작하는지 확인",
            "파일 첨부가 정상 동작하는지 확인"
          ]
        },
        {
          "id": "7.7",
          "title": "메시지 목록 컴포넌트 구현",
          "detailed_steps": [
            "src/components/message/message-list.tsx 생성",
            "메시지 타입별 렌더링 (USER: 프로필 아바타, 이름, 읽음 표시, SYSTEM: 시스템 메시지 스타일, FILE: 파일 아이콘, 다운로드 버튼)",
            "읽음 표시 표시",
            "메시지 삭제 버튼 (본인 작성 USER 메시지만)",
            "스크롤 컨테이너 구현",
            "자동 스크롤 로직 구현"
          ],
          "expected_output": ["메시지 목록 컴포넌트 생성"],
          "validation_steps": [
            "메시지가 타입별로 올바르게 표시되는지 확인",
            "읽음 표시가 정상 동작하는지 확인"
          ]
        },
        {
          "id": "7.8",
          "title": "읽음 처리 로직 구현",
          "detailed_steps": [
            "Task 상세 페이지 마운트 시 markAllMessagesAsRead 호출",
            "메시지 수신 시 읽음 처리 (선택사항)",
            "읽음 상태 UI 업데이트"
          ],
          "expected_output": ["읽음 처리 로직 구현됨"],
          "validation_steps": ["읽음 처리가 정상 동작하는지 확인"]
        },
        {
          "id": "7.9",
          "title": "입력 중 표시 기능 구현 (Broadcast)",
          "detailed_steps": [
            "메시지 입력 시 Broadcast 채널에 'typing' 이벤트 전송",
            "다른 사용자의 'typing' 이벤트 수신 시 '입력 중...' 표시",
            "일정 시간 후 자동으로 표시 제거"
          ],
          "expected_output": ["입력 중 표시 기능 구현됨"],
          "validation_steps": ["입력 중 표시가 정상 동작하는지 확인 (두 브라우저에서 테스트)"]
        }
      ]
    },
    {
      "id": 8,
      "status": "pending",
      "title": "이메일 알림 시스템 구현",
      "description": "Task 생성 및 상태 변경 시 이메일을 자동 발송하는 Edge Function을 구현한다.",
      "details": "send-task-email Edge Function 구현, invite-user Edge Function 구현, Gmail SMTP 연동, 이메일 템플릿 생성, 재시도 로직, 이메일 발송 로그 기록",
      "acceptance_criteria": [
        "Task 생성 시 assigner와 assignee 모두에게 이메일 발송됨",
        "Task 상태 변경 시 조건에 맞는 수신자에게 이메일 발송됨",
        "사용자 초대 시 이메일 발송됨",
        "이메일 발송 실패 시 재시도 로직이 동작함",
        "이메일 발송 로그가 기록됨"
      ],
      "test_plan": [
        "단위 테스트: Edge Function이 정상적으로 동작하는지 확인",
        "통합 테스트: Task 생성/상태 변경 시 이메일 발송 확인",
        "E2E 테스트: 실제 이메일 수신 확인"
      ],
      "dependencies": [3],
      "risks": [
        "SMTP 설정 오류로 인한 이메일 미발송",
        "Edge Function 타임아웃",
        "이메일 발송 실패 시 재시도 로직 오류"
      ],
      "sub_tasks": [
        {
          "id": "8.1",
          "title": "send-task-email Edge Function 구현",
          "detailed_steps": [
            "supabase/functions/send-task-email/index.ts 파일 생성",
            "Deno.serve()로 HTTP 핸들러 구현",
            "요청 본문 파싱: eventType, taskId, recipients 등",
            "Task 정보 조회 (Supabase Client 사용)",
            "수신자별 이메일 템플릿 생성",
            "Gmail SMTP로 이메일 발송 (nodemailer 사용)",
            "이메일 발송 로그 기록 (email_logs 테이블)"
          ],
          "expected_output": ["send-task-email Edge Function 구현됨"],
          "validation_steps": [
            "Edge Function이 정상적으로 배포되는지 확인",
            "이메일이 정상 발송되는지 확인"
          ]
        },
        {
          "id": "8.2",
          "title": "이메일 템플릿 구현",
          "detailed_steps": [
            "Task 생성 이메일 템플릿 생성 (assigner용, assignee용)",
            "상태 변경 이메일 템플릿 생성 (각 상태 전환별)",
            "HTML 이메일 템플릿 작성",
            "템플릿에 Task 정보, 프로젝트 정보 동적 삽입"
          ],
          "expected_output": ["이메일 템플릿 구현됨"],
          "validation_steps": ["이메일 템플릿이 정상적으로 렌더링되는지 확인"]
        },
        {
          "id": "8.3",
          "title": "Gmail SMTP 연동",
          "detailed_steps": [
            "Supabase Secrets에 SMTP_USER, SMTP_PASS 설정",
            "nodemailer 설정 (Gmail SMTP 서버 정보)",
            "이메일 발송 함수 구현",
            "에러 처리 및 로깅"
          ],
          "expected_output": ["Gmail SMTP 연동 완료"],
          "validation_steps": ["이메일이 정상 발송되는지 확인"]
        },
        {
          "id": "8.4",
          "title": "재시도 로직 구현",
          "detailed_steps": [
            "이메일 발송 실패 시 재시도 로직 구현 (최대 3회)",
            "재시도 간격 설정 (예: 1초, 2초, 4초)",
            "최종 실패 시 에러 로그 기록"
          ],
          "expected_output": ["재시도 로직 구현됨"],
          "validation_steps": ["재시도 로직이 정상 동작하는지 확인"]
        },
        {
          "id": "8.5",
          "title": "invite-user Edge Function 구현",
          "detailed_steps": [
            "supabase/functions/invite-user/index.ts 파일 생성",
            "요청 본문 파싱: email, inviterName",
            "초대 링크 생성 (비밀번호 재설정 토큰 사용)",
            "초대 이메일 템플릿 생성",
            "Gmail SMTP로 이메일 발송"
          ],
          "expected_output": ["invite-user Edge Function 구현됨"],
          "validation_steps": [
            "Edge Function이 정상적으로 배포되는지 확인",
            "초대 이메일이 정상 발송되는지 확인"
          ]
        },
        {
          "id": "8.6",
          "title": "이메일 발송 로그 테이블 생성",
          "detailed_steps": [
            "supabase/migrations/010_create_email_logs.sql 파일 생성",
            "CREATE TABLE email_logs (id UUID PRIMARY KEY, task_id UUID, recipient_email TEXT, email_type TEXT, status TEXT, error_message TEXT, created_at TIMESTAMPTZ)",
            "Edge Function에서 이메일 발송 시 로그 기록"
          ],
          "expected_output": ["이메일 발송 로그 테이블 생성됨"],
          "validation_steps": ["이메일 발송 시 로그가 정상 기록되는지 확인"]
        }
      ]
    },
    {
      "id": 9,
      "status": "pending",
      "title": "Admin 기능 및 사용자 관리 구현",
      "description": "Admin 전용 사용자 관리 페이지와 기능을 구현한다.",
      "details": "AdminUsersPage 구현, 사용자 목록 조회, 사용자 초대 기능, 사용자 활성화/비활성화 토글, Admin 전용 레이아웃 컴포넌트",
      "acceptance_criteria": [
        "Admin만 사용자 관리 페이지에 접근 가능함",
        "전체 사용자 목록이 표시됨",
        "사용자 초대 기능이 정상 동작함",
        "사용자 활성화/비활성화 토글이 정상 동작함",
        "비활성화된 사용자는 로그인 불가"
      ],
      "test_plan": [
        "단위 테스트: API 함수들이 정상적으로 동작하는지 확인",
        "통합 테스트: 사용자 초대 → 활성화/비활성화 플로우 테스트",
        "E2E 테스트: 브라우저에서 Admin 기능 전체 테스트"
      ],
      "dependencies": [2, 8],
      "risks": [
        "Admin 권한 검증 로직 오류",
        "사용자 초대 이메일 미발송",
        "비활성화된 사용자 로그인 차단 로직 오류"
      ],
      "sub_tasks": [
        {
          "id": "9.1",
          "title": "Admin API 함수 구현",
          "detailed_steps": [
            "src/api/admin.ts 파일 생성",
            "getAllUsers() 함수 구현: 전체 사용자 목록 조회 (Admin만)",
            "toggleUserStatus(userId, isActive) 함수 구현: 사용자 활성화/비활성화",
            "inviteUser(email) 함수 구현: Edge Function 호출"
          ],
          "expected_output": ["src/api/admin.ts 파일 생성", "Admin 관련 API 함수 구현됨"],
          "validation_steps": [
            "각 함수가 정상적으로 동작하는지 테스트",
            "권한 검증이 정상 동작하는지 확인"
          ]
        },
        {
          "id": "9.2",
          "title": "Admin React Query 훅 구현",
          "detailed_steps": [
            "src/hooks/queries/use-users.ts 파일 생성",
            "useUsers() 훅 구현: 전체 사용자 목록 조회",
            "src/hooks/mutations/use-admin.ts 파일 생성",
            "useToggleUserStatus() 훅 구현: 성공 시 캐시 무효화",
            "useInviteUser() 훅 구현"
          ],
          "expected_output": ["Admin 관련 React Query 훅 구현됨"],
          "validation_steps": ["훅이 정상적으로 동작하는지 테스트"]
        },
        {
          "id": "9.3",
          "title": "AdminUsersPage 구현",
          "detailed_steps": [
            "src/pages/admin-users-page.tsx 생성",
            "사용자 목록 테이블 구현 (이름, 이메일, 역할, 상태, 액션)",
            "사용자 초대 버튼 및 다이얼로그 구현",
            "사용자 활성화/비활성화 토글 버튼 구현",
            "클라이언트 사이드 검색/필터링 구현"
          ],
          "expected_output": ["AdminUsersPage 구현"],
          "validation_steps": [
            "사용자 목록이 정상 표시되는지 확인",
            "사용자 초대/활성화/비활성화가 정상 동작하는지 확인"
          ]
        },
        {
          "id": "9.4",
          "title": "Admin 전용 레이아웃 컴포넌트 구현",
          "detailed_steps": [
            "src/components/layout/admin-only-layout.tsx 생성",
            "현재 사용자 역할 확인 (Admin인지)",
            "Admin이 아니면 403 에러 페이지로 리다이렉트",
            "Admin이면 자식 컴포넌트 렌더링"
          ],
          "expected_output": ["Admin 전용 레이아웃 컴포넌트 생성"],
          "validation_steps": ["Admin이 아닌 사용자가 접근 시 리다이렉트되는지 확인"]
        },
        {
          "id": "9.5",
          "title": "사용자 초대 다이얼로그 구현",
          "detailed_steps": [
            "src/components/dialog/invite-user-dialog.tsx 생성",
            "이메일 입력 필드",
            "React Hook Form + Zod 스키마 적용",
            "폼 제출 시 inviteUser API 호출",
            "성공 메시지 표시"
          ],
          "expected_output": ["사용자 초대 다이얼로그 생성"],
          "validation_steps": [
            "다이얼로그가 정상 동작하는지 확인",
            "초대 이메일이 정상 발송되는지 확인"
          ]
        },
        {
          "id": "9.6",
          "title": "비활성화된 사용자 로그인 차단 로직 구현",
          "detailed_steps": [
            "로그인 시 프로필 조회하여 is_active 확인",
            "is_active가 false이면 로그인 차단 및 에러 메시지 표시",
            "SessionProvider에서 세션 확인 시 is_active 검증"
          ],
          "expected_output": ["비활성화된 사용자 로그인 차단 로직 구현됨"],
          "validation_steps": ["비활성화된 사용자가 로그인 불가한지 확인"]
        }
      ]
    },
    {
      "id": 10,
      "status": "pending",
      "title": "배포 및 최종 검증",
      "description": "프로덕션 환경 배포 및 전체 기능 검증을 수행한다.",
      "details": "환경 변수 설정, Vercel 배포, Supabase Edge Functions 배포, 전체 기능 테스트, 성능 테스트, 보안 검증, 문서화",
      "acceptance_criteria": [
        "프로덕션 환경에서 정상적으로 동작함",
        "모든 기능이 정상 동작함",
        "RLS 정책이 정상 동작함",
        "이메일 발송이 정상 동작함",
        "실시간 채팅이 정상 동작함",
        "성능이 허용 범위 내에 있음"
      ],
      "test_plan": [
        "단위 테스트: 모든 컴포넌트 및 함수 테스트",
        "통합 테스트: 전체 플로우 테스트",
        "E2E 테스트: 브라우저에서 전체 기능 테스트",
        "성능 테스트: 초기 로딩 시간, 메모리 사용량 확인",
        "보안 테스트: RLS 정책, 권한 검증 확인"
      ],
      "dependencies": [1, 2, 3, 4, 5, 6, 7, 8, 9],
      "risks": [
        "프로덕션 환경 설정 오류",
        "환경 변수 누락",
        "Edge Functions 배포 실패",
        "성능 이슈"
      ],
      "sub_tasks": [
        {
          "id": "10.1",
          "title": "환경 변수 설정",
          "detailed_steps": [
            "Vercel 프로젝트 설정에서 환경 변수 추가: VITE_SUPABASE_URL, VITE_SUPABASE_ANON_KEY",
            "Supabase Secrets 설정: SMTP_USER, SMTP_PASS, SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY",
            "환경 변수 확인 및 검증"
          ],
          "expected_output": ["모든 환경 변수가 설정됨"],
          "validation_steps": ["환경 변수가 정상적으로 설정되었는지 확인"]
        },
        {
          "id": "10.2",
          "title": "Vercel 배포",
          "detailed_steps": [
            "Vercel 프로젝트 생성 및 연결",
            "빌드 명령어 설정: npm run build",
            "배포 실행",
            "배포 후 정상 동작 확인"
          ],
          "expected_output": ["Vercel에 배포 완료"],
          "validation_steps": ["배포된 사이트가 정상 동작하는지 확인"]
        },
        {
          "id": "10.3",
          "title": "Supabase Edge Functions 배포",
          "detailed_steps": [
            "supabase functions deploy send-task-email 실행",
            "supabase functions deploy invite-user 실행",
            "Edge Functions 정상 동작 확인"
          ],
          "expected_output": ["Edge Functions 배포 완료"],
          "validation_steps": ["Edge Functions가 정상 동작하는지 확인"]
        },
        {
          "id": "10.4",
          "title": "전체 기능 테스트",
          "detailed_steps": [
            "인증 플로우 테스트 (회원가입 → 로그인 → 프로필 설정)",
            "프로젝트 관리 기능 테스트 (생성 → 수정 → 삭제)",
            "Task 관리 기능 테스트 (생성 → 상태 변경 → 삭제)",
            "실시간 채팅 기능 테스트 (메시지 전송 → 파일 전송 → 읽음 처리)",
            "이메일 발송 테스트 (Task 생성 → 상태 변경)",
            "Admin 기능 테스트 (사용자 초대 → 활성화/비활성화)"
          ],
          "expected_output": ["전체 기능 테스트 완료"],
          "validation_steps": ["모든 기능이 정상 동작하는지 확인"]
        },
        {
          "id": "10.5",
          "title": "권한 및 보안 검증",
          "detailed_steps": [
            "RLS 정책 검증: Admin/Member 권한 테스트",
            "프로젝트 접근 권한 검증",
            "Task 접근 권한 검증",
            "메시지 접근 권한 검증",
            "파일 업로드/다운로드 권한 검증"
          ],
          "expected_output": ["권한 및 보안 검증 완료"],
          "validation_steps": ["모든 권한 정책이 정상 동작하는지 확인"]
        },
        {
          "id": "10.6",
          "title": "성능 테스트",
          "detailed_steps": [
            "초기 로딩 시간 측정 (목표: 3초 이하)",
            "메모리 사용량 확인",
            "네트워크 요청 수 확인",
            "React Query 캐시 동작 확인",
            "Realtime 구독 메모리 누수 확인"
          ],
          "expected_output": ["성능 테스트 완료"],
          "validation_steps": ["성능이 허용 범위 내에 있는지 확인"]
        },
        {
          "id": "10.7",
          "title": "반응형 디자인 검증",
          "detailed_steps": [
            "모바일 화면에서 테스트 (< 768px)",
            "태블릿 화면에서 테스트 (768px ~ 1024px)",
            "데스크톱 화면에서 테스트 (> 1024px)",
            "칸반 보드 x축 스크롤 동작 확인"
          ],
          "expected_output": ["반응형 디자인 검증 완료"],
          "validation_steps": ["모든 화면 크기에서 정상 동작하는지 확인"]
        },
        {
          "id": "10.8",
          "title": "에러 처리 및 예외 상황 테스트",
          "detailed_steps": [
            "네트워크 오류 시나리오 테스트",
            "권한 오류 시나리오 테스트",
            "파일 업로드 실패 시나리오 테스트",
            "이메일 발송 실패 시나리오 테스트",
            "에러 메시지가 적절히 표시되는지 확인"
          ],
          "expected_output": ["에러 처리 테스트 완료"],
          "validation_steps": ["모든 에러 상황에서 적절히 처리되는지 확인"]
        }
      ]
    }
  ]
}
