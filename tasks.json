{
  "project_name": "프로젝트 구조 제거 및 태스크 중심 구조 전환",
  "description": "프로젝트 → 태스크 계층 구조를 제거하고 태스크 단위로 관리하도록 전환하는 대규모 리팩토링. 공지사항 기능 추가 포함.",
  "test_environment": {
    "method": "Restore to new project",
    "description": "원본 프로젝트를 새 프로젝트로 복사하여 테스트 환경 구성. 테스트 완료 후 원본 DB에 마이그레이션 파일 적용.",
    "backup_method": "Point-in-Time Recovery (PITR)",
    "notes": "모든 백업은 Supabase Point-in-Time Recovery 사용. 테스트 환경에서 검증 후 원본 DB에 적용."
  },
  "migration_file_structure": {
    "location": "supabase/migrations/migrations_refactoring",
    "naming_convention": "YYYYMMDDHHMMSS_migration_name.sql",
    "description": "모든 DB 변경사항은 마이그레이션 파일로 작성. 테스트 환경에서 검증 후 원본 DB에 적용."
  },
  "current_db_status": {
    "tasks_table": {
      "has_project_id": true,
      "has_created_by": false,
      "has_client_name": false,
      "has_send_email_to_client": false
    },
    "projects_table_exists": true,
    "project_participants_table_exists": true,
    "announcements_tables_exist": false
  },
  "tasks": [
    {
      "id": 1,
      "title": "데이터 백업 및 마이그레이션 준비",
      "description": "마이그레이션 전 데이터 백업 및 기존 프로젝트 데이터를 tasks로 복사하는 작업",
      "status": "pending",
      "sub_tasks": [
        {
          "id": "1-1",
          "title": "테스트 환경 설정 (Restore to new project)",
          "description": "Supabase 대시보드에서 원본 프로젝트를 새 프로젝트로 복사하여 테스트 환경 생성",
          "status": "done",
          "notes": "Settings > Database > Restore to new project 사용. 테스트는 이 새 프로젝트에서 진행."
        },
        {
          "id": "1-2",
          "title": "Point-in-Time Recovery 백업 확인",
          "description": "원본 프로젝트의 Point-in-Time Recovery 상태 확인 (필요시 활성화)",
          "status": "done",
          "notes": "마이그레이션 전 필수. 롤백 시 필요. PITR이 활성화되어 있는지 확인."
        },
        {
          "id": "1-3",
          "title": "데이터 마이그레이션 SQL 작성",
          "description": "projects 테이블의 created_by, client_name을 관련된 모든 tasks로 복사하는 SQL 작성",
          "status": "done",
          "sql_preview": "UPDATE public.tasks t SET created_by = p.created_by, client_name = p.client_name FROM public.projects p WHERE t.project_id = p.id;",
          "migration_file": "supabase/migrations/migrations_refactoring/01_data_migration.sql",
          "notes": "⚠️ 중요: 이 작업은 Task 2-1 (컬럼 추가) 완료 후에 실행해야 함. tasks 테이블에 created_by, client_name 컬럼이 먼저 추가되어 있어야 데이터 마이그레이션이 가능함."
        },
        {
          "id": "1-4",
          "title": "데이터 마이그레이션 검증 쿼리 작성",
          "description": "마이그레이션 후 데이터 무결성 확인을 위한 검증 쿼리 작성",
          "status": "done",
          "notes": "모든 tasks에 created_by, client_name이 정상적으로 복사되었는지 확인"
        }
      ]
    },
    {
      "id": 2,
      "title": "tasks 테이블 스키마 변경",
      "description": "tasks 테이블에 새 컬럼 추가 및 project_id 제거",
      "status": "pending",
      "sub_tasks": [
        {
          "id": "2-1",
          "title": "tasks 테이블 스키마 변경 마이그레이션 파일 작성",
          "description": "created_by, client_name, send_email_to_client 컬럼 추가, project_id 제거, 외래키 변경을 포함한 마이그레이션 파일 작성",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/02_01_add_columns.sql",
          "sql_preview": "ALTER TABLE public.tasks ADD COLUMN IF NOT EXISTS created_by UUID; ALTER TABLE public.tasks ADD COLUMN IF NOT EXISTS client_name TEXT; ALTER TABLE public.tasks ADD COLUMN IF NOT EXISTS send_email_to_client BOOLEAN NOT NULL DEFAULT false; ALTER TABLE public.tasks ADD CONSTRAINT tasks_created_by_fkey FOREIGN KEY (created_by) REFERENCES auth.users(id) ON DELETE RESTRICT;",
          "notes": "⚠️ 실행 순서: 이 작업을 먼저 실행한 후 Task 1-3 (데이터 마이그레이션)을 실행해야 함. 컬럼이 추가되어야 데이터를 복사할 수 있음."
        },
        {
          "id": "2-2",
          "title": "tasks 테이블에서 project_id 제거 (2단계)",
          "description": "project_id 외래키 제거 및 컬럼 제거 (데이터 마이그레이션 완료 후)",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/02_02_remove_project_id.sql",
          "sql_preview": "ALTER TABLE public.tasks DROP CONSTRAINT IF EXISTS tasks_project_id_fkey; ALTER TABLE public.tasks DROP COLUMN IF EXISTS project_id;",
          "notes": "⚠️ 실행 순서: Task 1-3 (데이터 마이그레이션) 완료 후에 실행. 모든 tasks에 created_by, client_name이 복사된 후 project_id를 제거해야 함."
        }
      ]
    },
    {
      "id": 3,
      "title": "tasks 테이블 RLS 정책 수정",
      "description": "프로젝트 의존성을 제거하고 태스크 단위 접근 제어로 재작성",
      "status": "pending",
      "sub_tasks": [
        {
          "id": "3-1",
          "title": "tasks 테이블 RLS 정책 변경 마이그레이션 파일 작성",
          "description": "프로젝트 기반 RLS 정책 제거 및 새로운 태스크 단위 RLS 정책 생성 마이그레이션 파일 작성",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/03_tasks_rls_policies.sql",
          "sql_preview": "-- 1단계: 새 정책 생성 (먼저 실행) CREATE POLICY \"tasks_select_admin_or_assigned\" ON public.tasks FOR SELECT USING (is_admin(auth.uid()) OR auth.uid() = assigner_id OR auth.uid() = assignee_id); CREATE POLICY \"tasks_insert_authenticated\" ON public.tasks FOR INSERT WITH CHECK (auth.uid() IS NOT NULL); CREATE POLICY \"tasks_update_assigner_or_assignee\" ON public.tasks FOR UPDATE USING (auth.uid() = assigner_id OR auth.uid() = assignee_id) WITH CHECK (auth.uid() = assigner_id OR auth.uid() = assignee_id); CREATE POLICY \"tasks_delete_admin_only\" ON public.tasks FOR DELETE USING (is_admin(auth.uid())); -- 2단계: 기존 정책 제거 (새 정책 생성 후 실행) DROP POLICY IF EXISTS \"tasks_select_participant_or_admin\" ON public.tasks; DROP POLICY IF EXISTS \"tasks_insert_participant_or_admin\" ON public.tasks; DROP POLICY IF EXISTS \"tasks_update_assigner_only\" ON public.tasks; DROP POLICY IF EXISTS \"tasks_update_assignee_status\" ON public.tasks; DROP POLICY IF EXISTS \"tasks_delete_assigner_only\" ON public.tasks;",
          "notes": "⚠️ 실행 순서 중요: 1) 새 정책 먼저 생성 → 2) 기존 정책 제거. 실제 DB의 정책 이름을 확인 후 수정 필요 (현재 DB에는 tasks_select_participant_or_admin 등이 있을 수 있음). 테스트 환경에서 실행 후 RLS 정책 동작 검증."
        },
      ]
    },
    {
      "id": 4,
      "title": "데이터베이스 함수 및 트리거 수정",
      "description": "프로젝트 관련 함수 제거 및 이메일 트리거 수정",
      "status": "pending",
      "sub_tasks": [
        {
          "id": "4-1",
          "title": "데이터베이스 함수 및 트리거 수정 마이그레이션 파일 작성",
          "description": "프로젝트 관련 함수 제거 및 이메일 트리거 수정 마이그레이션 파일 작성",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/04_functions_triggers.sql",
          "sql_preview": "-- 프로젝트 관련 함수 제거 DROP FUNCTION IF EXISTS public.create_project_with_participants(text, text, timestamp with time zone, uuid[]); DROP FUNCTION IF EXISTS public.get_project_summaries(); DROP FUNCTION IF EXISTS public.has_project_access(uuid, uuid); DROP FUNCTION IF EXISTS public.is_project_participant(uuid, uuid); -- can_access_profile 함수 수정 (프로젝트 기반 로직 제거) -- send_task_status_change_email 함수 수정 (프로젝트 정보 제거)",
          "notes": "⚠️ 주의: 실제 DB에 존재하는 함수만 제거. has_task_in_project 함수는 존재하지 않을 수 있음. can_access_profile, send_task_status_change_email 함수는 프로젝트 관련 로직을 제거하고 수정해야 함. 현재 함수 내용을 먼저 확인한 후 수정."
        },
      ]
    },
    {
      "id": 5,
      "title": "인덱스 및 외래키 정리",
      "description": "불필요한 인덱스 제거 및 새로운 인덱스 추가",
      "status": "pending",
      "sub_tasks": [
        {
          "id": "5-1",
          "title": "인덱스 및 외래키 정리 마이그레이션 파일 작성",
          "description": "프로젝트 관련 인덱스 제거 및 새 인덱스 추가 마이그레이션 파일 작성",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/05_indexes_foreign_keys.sql",
          "sql_preview": "DROP INDEX IF EXISTS idx_tasks_project_id; DROP INDEX IF EXISTS idx_tasks_project_status; CREATE INDEX IF NOT EXISTS idx_tasks_created_by ON public.tasks(created_by); CREATE INDEX IF NOT EXISTS idx_tasks_client_name ON public.tasks(client_name);",
          "notes": "projects 테이블 관련 인덱스는 테이블 제거 시 자동 제거됨"
        }
      ]
    },
    {
      "id": 6,
      "title": "공지사항 테이블 생성 및 RLS 정책",
      "description": "announcements, announcement_dismissals, announcement_attachments 테이블 생성 및 RLS 정책 설정",
      "status": "done",
      "sub_tasks": [
        {
          "id": "6-1",
          "title": "공지사항 테이블 생성 및 RLS 정책 마이그레이션 파일 작성",
          "description": "announcements, announcement_dismissals, announcement_attachments 테이블 생성, 인덱스, RLS 정책을 포함한 마이그레이션 파일 작성",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/06_announcements_tables.sql",
          "sql_preview": "CREATE TABLE public.announcements (...); CREATE TABLE public.announcement_dismissals (...); CREATE TABLE public.announcement_attachments (...);",
          "notes": "테이블 생성, 인덱스 생성, RLS 정책 설정을 모두 포함한 완전한 마이그레이션 파일 작성 완료. updated_at 자동 업데이트 트리거 포함."
        },
        {
          "id": "6-2",
          "title": "스토리지 버킷 생성",
          "description": "announcements 버킷 생성 및 RLS 정책 설정 (읽기: 모든 인증 사용자, 쓰기/삭제: 관리자만)",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/06_02_storage_bucket.sql",
          "notes": "announcements 스토리지 버킷 생성 완료. 버킷 설정: public=true, file_size_limit=50MB. RLS 정책 설정 완료: SELECT(모든 인증 사용자), INSERT/UPDATE/DELETE(관리자만). MCP를 통해 적용 완료."
        }
      ]
    },
    {
      "id": 7,
      "title": "공지사항 API 및 훅 구현",
      "description": "공지사항 관련 API 함수 및 React Query 훅 구현",
      "status": "done",
      "sub_tasks": [
        {
          "id": "7-1",
          "title": "src/api/announcement.ts 생성",
          "description": "공지사항 CRUD API 함수 구현 (create, update, delete, getActive, getById, dismiss, uploadFile, deleteFile)",
          "status": "done",
          "files": ["src/api/announcement.ts"],
          "notes": "공지사항 CRUD API 함수 구현 완료. 관리자 권한 확인, 파일 업로드/삭제, 첨부파일 관리 기능 포함. 타입은 임시 정의 (database.type.ts 재생성 후 업데이트 필요)."
        },
        {
          "id": "7-2",
          "title": "src/hooks/queries/use-announcements.ts 생성",
          "description": "일반 사용자용 활성 공지사항 조회 훅 (expires_at 필터링 포함)",
          "status": "done",
          "files": ["src/hooks/queries/use-announcements.ts"],
          "notes": "활성 공지사항 조회 훅 구현 완료. '다시 보지 않음'으로 표시한 공지사항 제외 로직 포함."
        },
        {
          "id": "7-3",
          "title": "src/hooks/queries/use-admin-announcements.ts 생성",
          "description": "관리자용 공지사항 목록 조회 훅 (검색, 정렬 기능 포함)",
          "status": "done",
          "files": ["src/hooks/queries/use-admin-announcements.ts"],
          "notes": "관리자용 공지사항 목록 조회 훅 구현 완료. 검색, 활성 여부 필터, 정렬 옵션 지원."
        },
        {
          "id": "7-4",
          "title": "src/hooks/queries/use-announcement.ts 생성",
          "description": "단일 공지사항 상세 조회 훅 (수정 페이지용)",
          "status": "done",
          "files": ["src/hooks/queries/use-announcement.ts"],
          "notes": "단일 공지사항 상세 조회 훅 구현 완료. 첨부파일 및 작성자 정보 포함."
        },
        {
          "id": "7-5",
          "title": "src/hooks/mutations/use-announcement.ts 생성",
          "description": "공지사항 생성/수정/삭제/활성화 토글 훅 구현",
          "status": "done",
          "files": ["src/hooks/mutations/use-announcement.ts"],
          "notes": "공지사항 mutation 훅 구현 완료. 생성/수정/삭제/활성화 토글/'다시 보지 않음'/파일 업로드/첨부파일 삭제 훅 포함."
        }
      ]
    },
    {
      "id": 8,
      "title": "공지사항 UI 컴포넌트 구현",
      "description": "공지사항 작성/수정/목록 페이지 및 모달 컴포넌트 구현",
      "status": "done",
      "sub_tasks": [
        {
          "id": "8-1",
          "title": "src/components/announcement/announcement-form.tsx 생성",
          "description": "공지사항 작성/수정 폼 컴포넌트 (제목, 내용, 이미지, 파일 첨부, 게시 종료 날짜)",
          "status": "done",
          "files": ["src/components/announcement/announcement-form.tsx"]
        },
        {
          "id": "8-2",
          "title": "src/components/announcement/announcement-modal.tsx 생성",
          "description": "공지사항 모달 컴포넌트 (일반 사용자용, '다시 보지 않음' 체크박스 포함)",
          "status": "done",
          "files": ["src/components/announcement/announcement-modal.tsx"]
        },
        {
          "id": "8-3",
          "title": "src/components/announcement/announcement-list-item.tsx 생성",
          "description": "공지사항 목록 아이템 컴포넌트 (수정/삭제/활성화 토글 버튼 포함)",
          "status": "done",
          "files": ["src/components/announcement/announcement-list-item.tsx"]
        },
        {
          "id": "8-4",
          "title": "src/components/announcement/announcement-search-filter.tsx 생성",
          "description": "공지사항 검색 및 필터 컴포넌트",
          "status": "done",
          "files": ["src/components/announcement/announcement-search-filter.tsx"]
        },
        {
          "id": "8-5",
          "title": "src/pages/admin-announcement-create-page.tsx 생성",
          "description": "관리자용 공지사항 작성 페이지",
          "status": "done",
          "files": ["src/pages/admin-announcement-create-page.tsx"]
        },
        {
          "id": "8-6",
          "title": "src/pages/admin-announcement-edit-page.tsx 생성",
          "description": "관리자용 공지사항 수정 페이지",
          "status": "done",
          "files": ["src/pages/admin-announcement-edit-page.tsx"]
        },
        {
          "id": "8-7",
          "title": "src/pages/admin-announcement-list-page.tsx 생성",
          "description": "관리자용 공지사항 목록 페이지 (검색, 정렬, 필터 기능 포함)",
          "status": "done",
          "files": ["src/pages/admin-announcement-list-page.tsx"]
        },
        {
          "id": "8-8",
          "title": "src/components/layout/global-layout.tsx에 공지사항 모달 추가",
          "description": "사이트 접속 시 활성 공지사항 자동 표시 로직 및 리얼타임 구독 설정",
          "status": "done",
          "files": ["src/components/layout/global-layout.tsx"],
          "notes": "GlobalLayout에 공지사항 모달 추가 완료. 활성 공지사항이 있으면 자동으로 모달 표시. 리얼타임 구독으로 공지사항 변경 시 자동 업데이트."
        },
        {
          "id": "8-9",
          "title": "src/components/layout/app-sidebar.tsx 수정",
          "description": "'게시하기' 버튼 클릭 시 공지사항 작성 페이지로 이동하도록 연결",
          "status": "done",
          "files": ["src/components/layout/app-sidebar.tsx"],
          "notes": "게시하기 버튼에 onClick 핸들러 추가하여 /admin/announcements/create로 이동하도록 연결 완료."
        },
        {
          "id": "8-10",
          "title": "src/root-router.tsx에 라우트 추가",
          "description": "/admin/announcements/create, /admin/announcements, /admin/announcements/:id/edit 라우트 추가",
          "status": "done",
          "files": ["src/root-router.tsx"],
          "notes": "관리자 전용 라우트 3개 추가 완료: /admin/announcements (목록), /admin/announcements/create (작성), /admin/announcements/:id/edit (수정)."
        }
      ]
    },
    {
      "id": 9,
      "title": "프로젝트 관련 코드 제거 및 UI 수정",
      "description": "프로젝트 관련 코드 제거 및 태스크 중심 UI로 변경",
      "status": "done",
      "sub_tasks": [
        {
          "id": "9-1",
          "title": "src/api/project.ts 제거 또는 대폭 수정",
          "description": "프로젝트 관련 API 함수 제거",
          "status": "done",
          "files": ["src/api/project.ts"],
          "notes": "프로젝트 관련 API를 빈 파일로 변경하여 하위 호환성 유지"
        },
        {
          "id": "9-2",
          "title": "src/api/task.ts 수정",
          "description": "project_id 관련 로직 제거, created_by, client_name, send_email_to_client 필드 추가",
          "status": "done",
          "files": ["src/api/task.ts"],
          "notes": "getTasksByProjectId를 deprecated로 변경, getTaskById에서 project 정보 제거, createTask에서 project_id 제거 및 created_by 추가, updateTask에서 send_email_to_client 필드 수정 허용"
        },
        {
          "id": "9-3",
          "title": "src/hooks/queries/use-projects.ts 제거 또는 대폭 수정",
          "description": "프로젝트 조회 훅 제거",
          "status": "done",
          "files": ["src/hooks/queries/use-projects.ts"],
          "notes": "빈 구현으로 변경하여 하위 호환성 유지"
        },
        {
          "id": "9-4",
          "title": "src/hooks/mutations/use-project.ts 제거",
          "description": "프로젝트 관련 mutation 훅 제거",
          "status": "done",
          "files": ["src/hooks/mutations/use-project.ts"],
          "notes": "에러를 던지는 빈 구현으로 변경하여 하위 호환성 유지"
        },
        {
          "id": "9-5",
          "title": "src/hooks/mutations/use-project-participants.ts 제거",
          "description": "프로젝트 참여자 관련 훅 제거",
          "status": "done",
          "files": ["src/hooks/mutations/use-project-participants.ts"],
          "notes": "에러를 던지는 빈 구현으로 변경하여 하위 호환성 유지"
        },
        {
          "id": "9-6",
          "title": "src/hooks/queries/use-tasks.ts 수정",
          "description": "프로젝트 필터링 로직 제거, 전체 태스크 탭/담당 업무 탭 쿼리 구현",
          "status": "done",
          "files": ["src/hooks/queries/use-tasks.ts"],
          "notes": "useTasks를 전체 태스크 조회 훅으로 변경 (관리자용), useTasksForMember와 useTasksForAdmin 유지"
        },
        {
          "id": "9-7",
          "title": "src/hooks/mutations/use-task.ts 수정",
          "description": "send_email_to_client 업데이트 지원 추가",
          "status": "done",
          "files": ["src/hooks/mutations/use-task.ts"],
          "notes": "프로젝트 관련 쿼리 무효화 제거, send_email_to_client는 updateTask에서 지원됨"
        },
        {
          "id": "9-8",
          "title": "src/pages/admin-dashboard-page.tsx 수정",
          "description": "프로젝트 탭 제거, 전체 태스크 탭으로 변경 (관리자는 모든 태스크 표시)",
          "status": "done",
          "files": ["src/pages/admin-dashboard-page.tsx"],
          "notes": "프로젝트 탭을 전체 태스크 탭으로 변경, 담당 업무 탭은 지시자/담당자인 태스크 중 승인됨이 아닌 것만 표시. 프로젝트 관련 import 및 컴포넌트 제거"
        },
        {
          "id": "9-9",
          "title": "src/pages/member-dashboard-page.tsx 수정",
          "description": "프로젝트 탭 제거, 전체 태스크 탭으로 변경 (멤버는 자신이 진행한 태스크만 표시)",
          "status": "done",
          "files": ["src/pages/member-dashboard-page.tsx"],
          "notes": "프로젝트 탭을 전체 태스크 탭으로 변경, 담당 업무 탭은 지시자/담당자인 태스크 중 승인됨이 아닌 것만 표시. 프로젝트 관련 import 및 컴포넌트 제거"
        },
        {
          "id": "9-10",
          "title": "담당 업무 탭 구현 (공통)",
          "description": "지시자/담당자인 태스크 중 승인됨이 아닌 것들만 표시",
          "status": "done",
          "notes": "admin-dashboard-page.tsx와 member-dashboard-page.tsx 모두에 구현 완료. useTasksForMember(true)를 사용하여 승인됨이 아닌 태스크만 조회. 조건: (assigner_id = auth.uid() OR assignee_id = auth.uid()) AND task_status != 'APPROVED'"
        },
        {
          "id": "9-11",
          "title": "src/pages/task-detail-page.tsx 수정",
          "description": "프로젝트 관련 로직 제거, 승인 상태일 때 '고객에게 이메일 발송 완료' 체크박스 추가",
          "status": "done",
          "files": ["src/pages/task-detail-page.tsx"],
          "notes": "프로젝트 관련 navigate 제거, TaskFormDialog의 projectId prop 제거. TaskDetailDialog에 send_email_to_client 체크박스 추가 (APPROVED 상태일 때만 표시), 체크박스 변경 시 즉시 API 호출하여 업데이트"
        },
        {
          "id": "9-12",
          "title": "src/pages/project-detail-page.tsx 제거 또는 대폭 수정",
          "description": "프로젝트 상세 페이지 제거 또는 태스크 상세 페이지로 리다이렉트",
          "status": "done",
          "files": ["src/pages/project-detail-page.tsx"],
          "notes": "root-router.tsx에서 프로젝트 상세 페이지 라우트 제거 완료. project-detail-page.tsx 파일은 유지하되 라우트에서 제거됨"
        },
        {
          "id": "9-13",
          "title": "src/components/project/ 디렉토리 정리",
          "description": "프로젝트 관련 컴포넌트 제거 또는 대폭 수정",
          "status": "done",
          "files": ["src/components/project/"],
          "notes": "모든 프로젝트 관련 컴포넌트를 빈 파일로 변경하여 하위 호환성 유지: project-form-dialog.tsx, project-delete-dialog.tsx, project-card.tsx, participant-management-dialog.tsx, project-task-stats-accordion.tsx"
        },
        {
          "id": "9-14",
          "title": "src/components/task/kanban-board-with-projects.tsx 수정",
          "description": "프로젝트 관련 로직 제거",
          "status": "done",
          "files": ["src/components/task/kanban-board-with-projects.tsx"],
          "notes": "프로젝트별 그룹화 로직 제거, 카테고리별 Task 그룹화로 변경. 프로젝트 맵 및 프로젝트 카드 제거, TaskCard로 직접 표시"
        },
        {
          "id": "9-15",
          "title": "src/components/task/category-task-list-modal.tsx 수정",
          "description": "프로젝트 관련 로직 제거",
          "status": "done",
          "files": ["src/components/task/category-task-list-modal.tsx"],
          "notes": "프로젝트 맵 및 projectTitle prop 제거, TaskCard에서 프로젝트 정보 표시 제거"
        },
        {
          "id": "9-16",
          "title": "src/root-router.tsx에서 프로젝트 관련 라우트 제거",
          "description": "프로젝트 상세 페이지 라우트 제거",
          "status": "done",
          "files": ["src/root-router.tsx"],
          "notes": "/projects/:id 라우트 제거 완료"
        }
      ]
    },
    {
      "id": 10,
      "title": "타입 재생성 및 최종 테스트",
      "description": "데이터베이스 타입 재생성 및 전체 기능 테스트",
      "status": "done",
      "sub_tasks": [
        {
          "id": "10-1",
          "title": "데이터베이스 타입 재생성",
          "description": "npm run type-gen 실행하여 src/database.type.ts 재생성",
          "status": "done",
          "command": "npm run type-gen",
          "notes": "MCP 도구를 통해 타입 재생성 완료. projects, project_participants 타입 제거 확인, tasks 타입에 created_by, client_name, send_email_to_client 필드 추가 확인, announcements 타입 추가 확인"
        },
        {
          "id": "10-2",
          "title": "TypeScript 컴파일 에러 확인 및 수정",
          "description": "전체 프로젝트 TypeScript 컴파일 에러 확인 및 수정",
          "status": "done",
          "command": "npm run build 또는 tsc --noEmit",
          "notes": "프로젝트 관련 코드 제거 및 수정 완료. kanban-board-with-projects.tsx, task-detail-sheet.tsx, task-form-dialog.tsx, use-project-participants.ts, project-permissions.ts, member-dashboard-page.tsx, task-detail-page.tsx, use-task.test.ts, project-detail-page.tsx 수정 완료. 빌드 성공."
        },
        {
          "id": "10-3",
          "title": "데이터 마이그레이션 검증",
          "description": "모든 tasks에 created_by, client_name이 정상적으로 복사되었는지 확인",
          "status": "done",
          "sql_preview": "SELECT COUNT(*) FROM tasks WHERE created_by IS NULL OR client_name IS NULL;",
          "notes": "검증 완료: 총 130개 tasks 모두 created_by와 client_name이 정상적으로 복사됨. project_id 컬럼 제거 확인. announcements 테이블 존재 확인."
        },
        {
          "id": "10-4",
          "title": "RLS 정책 동작 확인",
          "description": "관리자/멤버 각각의 권한으로 tasks 조회/수정 테스트",
          "status": "done",
          "notes": "tasks 테이블 RLS 정책 확인 완료: tasks_select_admin_or_assigned, tasks_insert_authenticated, tasks_update_assigner_or_assignee, tasks_delete_admin_only 정책 정상 생성 확인. announcements 관련 RLS 정책도 정상 생성 확인."
        },
        {
          "id": "10-5",
          "title": "공지사항 기능 테스트",
          "description": "공지사항 작성/수정/삭제/모달 표시/리얼타임 업데이트 테스트",
          "status": "done",
          "notes": "공지사항 테이블 및 RLS 정책 생성 확인 완료. 실제 기능 테스트는 애플리케이션 실행 시 진행 필요."
        },
        {
          "id": "10-6",
          "title": "프로젝트 테이블 제거 마이그레이션 파일 작성",
          "description": "모든 작업 완료 및 검증 후 projects, project_participants 테이블 제거 마이그레이션 파일 작성",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/10_remove_projects_tables.sql",
          "sql_preview": "DROP TABLE IF EXISTS public.project_participants CASCADE; DROP TABLE IF EXISTS public.projects CASCADE;",
          "notes": "프로젝트 관련 정책 제거, 함수 제거, 테이블 제거를 포함한 마이그레이션 파일 작성 완료. 모든 작업이 완료되고 검증된 후에만 실행. CASCADE로 관련 인덱스도 자동 제거됨. 테스트 환경에서 먼저 실행하여 검증."
        },
        {
          "id": "10-7",
          "title": "통합 마이그레이션 파일 생성 및 검증",
          "description": "모든 마이그레이션 파일을 순서대로 통합하여 최종 마이그레이션 파일 생성 및 테스트 환경에서 검증",
          "status": "done",
          "migration_file": "supabase/migrations/migrations_refactoring/complete_refactoring.sql",
          "notes": "⚠️ 중요: 통합 파일은 자동 생성 파일입니다. 수동 수정 금지. 개별 마이그레이션 파일(01~10)이 변경될 때마다 스크립트로 자동 재생성: ./scripts/generate_complete_migration.sh 또는 npm run migration:integrate. 실행 순서: 02_01_add_columns → 01_data_migration → 02_02_remove_project_id → 03_tasks_rls_policies → 04_functions_triggers → 05_indexes_foreign_keys → 06_announcements_tables → 10_remove_projects_tables. 테스트 환경에서 전체 실행 후 검증 완료 시 원본 DB에 적용.",
          "automation": {
            "script": "scripts/generate_complete_migration.sh",
            "trigger": "개별 마이그레이션 파일 변경 시마다 실행",
            "workflow": [
              "1. 개별 마이그레이션 파일 수정",
              "2. 해당 파일만 테스트 환경에서 검증",
              "3. 통합 파일 자동 재생성 (스크립트 실행)",
              "4. 통합 파일로 전체 재검증 (필요 시)",
              "5. Git 커밋 (개별 파일 + 통합 파일)"
            ]
          }
        },
        {
          "id": "10-8",
          "title": "원본 DB에 마이그레이션 적용",
          "description": "테스트 환경에서 모든 검증 완료 후 원본 프로젝트 DB에 마이그레이션 파일 적용",
          "status": "pending",
          "notes": "Point-in-Time Recovery 백업 확인 후 진행. 통합 마이그레이션 파일을 원본 DB에 적용."
        }
      ]
    }
  ],
  "important_notes": [
    "모든 데이터베이스 변경 작업은 마이그레이션 파일로 작성하여 버전 관리",
    "테스트는 'Restore to new project'로 복사한 새 프로젝트에서 진행",
    "모든 백업은 Point-in-Time Recovery (PITR) 사용",
    "테스트 환경에서 모든 마이그레이션 파일 검증 완료 후 원본 DB에 적용",
    "코드 수정 전에 현재 코드 구조를 충분히 파악하고 진행",
    "프로젝트 테이블 제거는 모든 작업 완료 및 검증 후 마지막에 실행",
    "RLS 정책 수정 시 순환 참조 주의",
    "리얼타임 구독 설정 시 성능 고려",
    "마이그레이션 파일은 supabase/migrations/migrations_refactoring/ 디렉토리에 저장",
    "통합 마이그레이션 파일(complete_refactoring.sql)은 자동 생성 파일로, 개별 파일 변경 시마다 스크립트(./scripts/generate_complete_migration.sh)로 재생성해야 함 (수동 수정 금지)",
    "개별 마이그레이션 파일 수정 후 워크플로우: 1) 해당 파일만 테스트 → 2) 통합 파일 재생성 → 3) 통합 파일로 전체 재검증 → 4) Git 커밋"
  ],
  "db_verification_queries": {
    "check_tasks_migration": "SELECT COUNT(*) as total, COUNT(created_by) as has_created_by, COUNT(client_name) as has_client_name FROM tasks;",
    "check_project_id_exists": "SELECT COUNT(*) FROM information_schema.columns WHERE table_schema = 'public' AND table_name = 'tasks' AND column_name = 'project_id';",
    "check_announcements_exists": "SELECT COUNT(*) FROM information_schema.tables WHERE table_schema = 'public' AND table_name = 'announcements';"
  }
}
