# Task 채팅 로그 전면 재구현 요약

## 원인 분석 (3줄 요약)

1. **기존 로직의 근본 문제**: `message_logs`가 `system_message_id` 기반으로 메시지 범위를 시간으로 추론하는 방식이었는데, 트리거 실행 순서 문제와 복잡한 카운트 업데이트 로직으로 인해 정확한 메시지 참조가 불가능했음.
2. **프론트엔드 필터링의 한계**: 백엔드에서 명시적으로 어떤 메시지가 로그에 속하는지 저장하지 않고, 프론트엔드에서 시간 범위로 필터링하여 UI와 DB 간 불일치 발생.
3. **데이터 일관성 문제**: 카운트 업데이트 트리거가 실패하거나 지연되면 `file_count`/`text_count`가 0으로 유지되어 UI에 "아무 내용도 존재하지 않음"이 표시됨.

## 해결 방안

**명시적 참조 테이블 방식**으로 전환:
- `task_chat_logs`: 로그 메타데이터만 저장
- `task_chat_log_items`: 로그가 참조하는 메시지 ID를 명시적으로 저장 (배열 대신 조인 테이블)
- 상태 변경 시 트랜잭션으로 로그 생성 + 메시지 참조 추가

## 구현 완료 상태

✅ **모든 작업 완료**
- 백엔드 마이그레이션 작성 완료
- API 로직 수정 완료
- 프론트엔드 컴포넌트 수정 완료
- 타입 정의 완료 (타입 재생성 필요)

⚠️ **다음 단계 필수**
1. 마이그레이션 적용 (Supabase)
2. 타입 재생성 (`npm run type-gen`)
3. 통합 테스트 수행
